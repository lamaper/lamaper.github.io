<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="zh" >
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  ><!-- Setup Open Graph image -->

  

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="2025数学建模第一次校赛复盘" />
<meta name="author" content="lamaper" />
<meta property="og:locale" content="zh" />
<meta name="description" content="第一次数学建模尝试" />
<meta property="og:description" content="第一次数学建模尝试" />
<link rel="canonical" href="/posts/25school1/" />
<meta property="og:url" content="/posts/25school1/" />
<meta property="og:site_name" content="lamaper" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-04-06T23:50:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="2025数学建模第一次校赛复盘" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"lamaper","url":"https://github.com/lamaper/"},"dateModified":"2025-04-06T23:50:00+08:00","datePublished":"2025-04-06T23:50:00+08:00","description":"第一次数学建模尝试","headline":"2025数学建模第一次校赛复盘","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/25school1/"},"url":"/posts/25school1/"}</script>
<!-- End Jekyll SEO tag -->


  <title>2025数学建模第一次校赛复盘 | lamaper
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="icon" type="image/png" href="/assets/img/favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/svg+xml" href="/assets/img/favicons/favicon.svg">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">

  <link rel="manifest" href="/assets/img/favicons/site.webmanifest">



  <!-- Resource Hints -->
  
    
      
        <link rel="preconnect" href="https://fonts.googleapis.com" >
      
        <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
      
    
      
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      
        <link rel="dns-prefetch" href="https://fonts.gstatic.com" >
      
    
      
        <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      
        <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
      
    
  

  <!-- Bootstrap -->
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css">
  

  <!-- Theme style -->
  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  <!-- Web Font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css">

  <!-- 3rd-party Dependencies -->

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.36.4/dist/tocbot.min.css">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css">
  

  
    <!-- Image Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css">
  

  <!-- Scripts -->

  <script src="/assets/js/dist/theme.min.js"></script>

  <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->


  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  



  <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.18/dayjs.min.js,npm/dayjs@1.11.18/locale/en.js,npm/dayjs@1.11.18/plugin/relativeTime.js,npm/dayjs@1.11.18/plugin/localizedFormat.js,npm/tocbot@4.36.4/dist/tocbot.min.js,npm/mermaid@11.12.0/dist/mermaid.min.js"></script>







<script defer src="/assets/js/dist/post.min.js"></script>


  <!-- MathJax -->
  <script src="/assets/js/data/mathjax.js"></script>
  <script async src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-chtml.js"></script>


<!-- Pageviews -->

  

  



  

  <!-- A placeholder to allow defining custom metadata -->

</head>


  <body>
    <!-- The Side Bar -->

<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle"><img src="https://avatars.githubusercontent.com/u/108182318?v=4" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a>

    <a class="site-title d-block" href="/">lamaper</a>
    <p class="site-subtitle fst-italic mb-0">Web / CTF / Coding</p>
  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>HOME</span>
        </a>
      </li>
      <!-- the real tabs -->
      
        <li class="nav-item">
          <a href="/categories/" class="nav-link">
            <i class="fa-fw fas fa-stream"></i>
            

            <span>CATEGORIES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/tags/" class="nav-link">
            <i class="fa-fw fas fa-tags"></i>
            

            <span>TAGS</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/archives/" class="nav-link">
            <i class="fa-fw fas fa-archive"></i>
            

            <span>ARCHIVES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/about/" class="nav-link">
            <i class="fa-fw fas fa-info-circle"></i>
            

            <span>ABOUT</span>
          </a>
        </li>
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    
      <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle">
        <i class="fas fa-adjust"></i>
      </button>

      
        <span class="icon-border"></span>
      
    

    

      
        <a
          href="https://github.com/lamaper"
          aria-label="github"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-github"></i>
        </a>
      
    

      
        <a
          href="javascript:location.href = 'mailto:' + ['lamaper','qq.com'].join('@')"
          aria-label="email"
          

          

          

          
        >
          <i class="fas fa-envelope"></i>
        </a>
      
    
          
        

      
        <a
          href="/feed.xml"
          aria-label="rss"
          

          

          

          
        >
          <i class="fas fa-rss"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar">
  <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/">Home</a>
            </span>

          
        
          
        
          
            
              <span>2025数学建模第一次校赛复盘</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      Post
    </div>

    <button type="button" id="search-trigger" class="btn btn-link" aria-label="Search">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search id="search" class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="Search..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->





<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  

  
  

  




<!-- return -->










<article class="px-1" data-toc="true">
  <header>
    <h1 data-toc-skip>2025数学建模第一次校赛复盘</h1>
    
      <p class="post-desc fw-light mb-4">第一次数学建模尝试</p>
    

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        Posted
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1743954600"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  Apr  6, 2025
</time>

      </span>

      <!-- lastmod date -->
      

      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          By

          <em>
            
              
                <a href="https://github.com/lamaper/">lamaper</a>
                
              
            
          </em>
        </span>

        <div>
          <!-- pageviews -->
          

          <!-- read time -->
          <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="4109 words"
>
  <em>22 min</em> read</span>

        </div>
      </div>
    </div>
  </header>

  
    <div id="toc-bar" class="d-flex align-items-center justify-content-between invisible">
      <span class="label text-truncate">2025数学建模第一次校赛复盘</span>
      <button type="button" class="toc-trigger btn me-1">
        <i class="fa-solid fa-list-ul fa-fw"></i>
      </button>
    </div>

    <button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm">
      <span class="label ps-2 pe-1">Contents</span>
      <i class="fa-solid fa-angle-right fa-fw"></i>
    </button>

    <dialog id="toc-popup" class="p-0">
      <div class="header d-flex flex-row align-items-center justify-content-between">
        <div class="label text-truncate py-2 ms-4">2025数学建模第一次校赛复盘</div>
        <button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75">
          <i class="fas fa-close"></i>
        </button>
      </div>
      <div id="toc-popup-content" class="px-4 py-3 pb-4"></div>
    </dialog>
  

  <div class="content">
    <h3 id="intro"><span class="me-2">Intro</span><a href="#intro" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>清明节献祭了假期，来打建模大赛。第一次打建模，实际上处于一个什么都不会的状态，全靠大语言模型来协助与学习。但是仔细思考过后，我认为自己不应该做一个知识的搬运工，既然搬运都搬运了，那就在这过程中把能学的都学会，不然最后的收获就是零蛋。</p>

<p>抱着这个想法，开始复盘一下这次数学建模的历程，看看能从中学到什么。</p>

<blockquote>
  <p><strong>2025年北京理工大学数学建模竞赛A题 租房价格</strong></p>

  <p>Airbnb 作为全球领先的短租平台，其房源价格受多种因素影响，包括地理位置、房源属性、市场供需关系及房东经营策略等。合理的定价不仅影响房东的收益，也直接关系到房源的入住率和市场竞争力。请基于2024年纽约市 Airbnb 房源数据，针对平台上房源经营与定价问题展开深入研究。</p>

  <p>参赛者需基于附件1所给数据，建立数学模型回答如下问题：</p>

  <p>对原始数据进行预处理，包括缺失、异常与重复数据的检测与处理，并说明判断缺失、异常的理由以及处理的方法。利用描述性统计分析，定量地呈现数据各指标的分布特性和基本统计规律。针对房源在不同维度上的表现，分析各个细分市场的特征、分布规律及其潜在的经营价值，为制定针对性策略提供理论依据。分析地理位置及其他相关变量对房价、入住率的影响，给出空间自相关性和地理位置的差异对房价、入住率的影响，揭示各因素之间的内在联系。考虑不同细分市场和区域之间的差异性，给出兼顾收益与入住率的最优定价策略。策略实施过程中可能面临哪些风险？请给出相应的改进方向。</p>

  <p>附件1中各字段的意义解释：</p>

  <p><strong>id</strong>：每个房源的唯一标识符，用于区分不同的房源。</p>

  <p><strong>name</strong>：房源的名称或标题，通常由房东设置，用以描述房源特点或吸引住客。</p>

  <p><strong>host_id</strong>：房东的唯一标识符，每个房东对应一个 host_id，用来关联同一房东的多个房源。</p>

  <p><strong>host_name</strong>：房东的名称，有时是昵称或真实姓名，便于识别房东。</p>

  <p><strong>neighbourhood_group</strong>：较大区域的分组，在纽约市中通常指曼哈顿、布鲁克林、皇后区等大区。</p>

  <p><strong>neighbourhood</strong>：具体的街区或小区域，标识房源所在的更细致位置。</p>

  <p><strong>latitude</strong>：房源位置的纬度坐标，用于在地图上定位。</p>

  <p><strong>longitude</strong>：房源位置的经度坐标，同样用于地理定位。</p>

  <p><strong>room_type</strong>：房间类型，常见的有整套房源、私人房间和共享房间，反映住客能享受的空间类型。</p>

  <p><strong>price</strong>：房源每晚的租金价格，通常以美元为单位。</p>

  <p><strong>minimum_nights</strong>：预订该房源所要求的最少入住夜数。</p>

  <p><strong>number_of_reviews</strong>：房源累计获得的评价数量，反映住客的反馈记录。</p>

  <p><strong>last_review</strong>：最近一次评价的日期，表示最近一次住客反馈的时间。</p>

  <p><strong>reviews_per_month</strong>：平均每月收到的评价数量，可以反映房源的预订活跃度。</p>

  <p><strong>calculated_host_listings_count</strong>：房东在平台上所发布的房源数量，展示房东的房源管理规模。</p>

  <p><strong>availability_365</strong>：表示房源在一年中可供预订的天数，用于衡量房源的空置率或使用率。</p>

  <p><strong>number_of_reviews_ltm</strong>：最近12个月内获得的评价数量，反映近期的预订情况和住客反馈。</p>

  <p><strong>license</strong>：房源的营业执照或许可号码（若有提供），用于证明房源符合当地的出租规定和法规要求。</p>
</blockquote>

<p>首先对赛题进行拆解，个人认为这个赛题十分人性化了，已经把该给到的都给了。最终经过分析，我们队伍把问题拆分成了如下几点：</p>

<blockquote>
  <p>1-1 对原始数据进行<strong>预处理</strong>：包括缺失、异常与重复数据的检测与处理</p>

  <p>1-2 说明判断缺失、异常的理由以及处理方法</p>

  <p>1-3 利用<strong>描述性统计</strong>分析，定量地呈现数据各指标的分布特性和基本统计规律</p>

  <p>2-1 针对房源在<strong>不同维度</strong>上的表现</p>

  <p>2-2 分析各个<strong>细分市场</strong>的特征、分布规律及其潜在经营价值</p>

  <p>2-3 为制定针对性策略提供<strong>理论依据</strong></p>

  <p>3-1 分析地理位置及其他相关变量对房价、入住率的<strong>影响</strong></p>

  <p>3-2 给出空间自相关性和地理位置的差异对房价、入住率的影响</p>

  <p>3-3 揭示各因素(3-1 &amp; 3-2)之间的<strong>内在联系</strong></p>

  <p>4-1 考虑(不同细分市场的差异性)和(不同区域之间的差异性)</p>

  <p>给出<strong>兼顾</strong>收益<strong>与</strong>入住率的最优<strong>定价策略</strong></p>

  <p>4-2 思考策略实施过程中可能面临的<strong>风险</strong>,并给出相应的<strong>改进方向</strong></p>
</blockquote>

<p>之后就开始<del>愉快地</del>工作。首先是数据处理，为了让论文更加的高大上，我们决定来点骚的，看上去厉害的方法。在大语言模型的建议下，我们采用了多重插补法（MICE）对数据进行处理。</p>

<h3 id="multiple-imputation-by-chained-equations"><span class="me-2">Multiple Imputation by Chained Equations</span><a href="#multiple-imputation-by-chained-equations" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<blockquote>
  <p>MICE（Multiple Imputation by Chained Equations）是一种基于贝叶斯思想的多重插补技术，用于处理缺失数据。它的基本原理是通过多次迭代，根据已有数据的信息来估计缺失值，并且不断更新估计模型。具体地，MICE将变量分为两类：需要插值的目标变量和其他辅助变量。然后，对于每个目标变量，MICE利用其他辅助变量的信息来进行插值，并不断迭代，直到收敛为止。</p>
</blockquote>

<p><a href="https://zhuanlan.zhihu.com/p/673954517">从mice到missForest：常用数据插值方法优缺点 - 知乎</a>的3.1部分介绍了这一技术的详细原理。MICE具有灵活性，能够根据数据集的特点进行模型选择和参数调整，同时对于缺失模式的敏感性较低。但在处理非线性关系和大规模数据集时表现一般。这里主要对如何进行MICE进行讨论和研究，以确保这个方法有可复现性。</p>

<p>首先需要导入两个基本的库<code class="language-plaintext highlighter-rouge">pandas</code>和<code class="language-plaintext highlighter-rouge">numpy</code>，然后使用<code class="language-plaintext highlighter-rouge">statsmodels.imputation.mice</code>的mice模块来进行真正的插补操作。</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="n">statsmodels.imputation.mice</span> <span class="kn">import</span> <span class="n">MICEData</span>
<span class="kn">from</span> <span class="n">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OrdinalEncoder</span>
</pre></td></tr></tbody></table></code></div></div>

<p>由于该算法通常需要数值型输入，其内部模型（如线性回归、决策树等）依赖数值计算，所以还要对非数值内容进行编码，使其变为数值，这里用到了<code class="language-plaintext highlighter-rouge">sklearn.preprocessing</code></p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre><span class="c1"># 读取原始数据
</span><span class="n">raw_data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="sh">'</span><span class="s">data_FIX.csv</span><span class="sh">'</span><span class="p">)</span>
<span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">seed</span><span class="p">(</span><span class="mi">2024</span><span class="p">)</span>
<span class="c1"># ===== 数据预处理阶段 =====
# 1. 保留所有原始字段
</span><span class="n">data</span> <span class="o">=</span> <span class="n">raw_data</span><span class="p">.</span><span class="nf">copy</span><span class="p">()</span>

<span class="c1"># 2. 处理时间特征（不删除原列）
</span><span class="n">max_date</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">last_review</span><span class="sh">'</span><span class="p">]).</span><span class="nf">max</span><span class="p">()</span>
<span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">last_review_days</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_date</span> <span class="o">-</span> <span class="n">pd</span><span class="p">.</span><span class="nf">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">last_review</span><span class="sh">'</span><span class="p">])).</span><span class="n">dt</span><span class="p">.</span><span class="n">days</span>
<span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">license</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">license</span><span class="sh">'</span><span class="p">].</span><span class="nf">fillna</span><span class="p">(</span><span class="sh">'</span><span class="s">UNLICENSED</span><span class="sh">'</span><span class="p">)</span>
<span class="c1"># 3. 编码分类变量（创建副本列进行编码）
</span><span class="n">geo_encoder</span> <span class="o">=</span> <span class="nc">OrdinalEncoder</span><span class="p">()</span>
<span class="n">room_type_encoder</span> <span class="o">=</span> <span class="nc">OrdinalEncoder</span><span class="p">()</span>

<span class="c1"># 创建编码副本列
</span><span class="n">data</span><span class="p">[[</span><span class="sh">'</span><span class="s">ng_encoded</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">n_encoded</span><span class="sh">'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">geo_encoder</span><span class="p">.</span><span class="nf">fit_transform</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="sh">'</span><span class="s">neighbourhood_group</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">neighbourhood</span><span class="sh">'</span><span class="p">]])</span>
<span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">rt_encoded</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">room_type_encoder</span><span class="p">.</span><span class="nf">fit_transform</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="sh">'</span><span class="s">room_type</span><span class="sh">'</span><span class="p">]])</span>
</pre></td></tr></tbody></table></code></div></div>

<p>之后开始核心的插补过程。在官方文档中，可以找到每个参数的意义<a href="https://www.statsmodels.org/stable/generated/statsmodels.imputation.mice.MICE.html">statsmodels.imputation.mice.MICE - statsmodels 0.14.4</a>，文档规定了MICE的代码如下：</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">statsmodels</span><span class="p">.</span><span class="n">imputation</span><span class="p">.</span><span class="n">mice</span><span class="p">.</span><span class="nc">MICEData</span><span class="p">(</span><span class="n">data</span><span class="p">,</span>
            <span class="n">perturbation_method</span><span class="o">=</span><span class="sh">'</span><span class="s">gaussian</span><span class="sh">'</span><span class="p">,</span>
            <span class="n">k_pmm</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
            <span class="n">history_callback</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th>参数</th>
      <th>类型</th>
      <th>含义</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>data</td>
      <td><code class="language-plaintext highlighter-rouge">Pandas</code> ,<code class="language-plaintext highlighter-rouge">data</code> ,<code class="language-plaintext highlighter-rouge">frame</code></td>
      <td>The data set, which is copied internally.这里是值传递</td>
    </tr>
    <tr>
      <td>perturbation_method</td>
      <td><code class="language-plaintext highlighter-rouge">str</code></td>
      <td>The default perturbation method.即默认的扰动模型，这里默认为高斯扰动。另外还可以选择boot模型，</td>
    </tr>
    <tr>
      <td>k_pmm</td>
      <td><code class="language-plaintext highlighter-rouge">int</code></td>
      <td>The number of nearest neighbors to use during predictive mean matching. PMM是一种基于模型的数据插补方法，它通过建立预测模型来预测缺失值，并根据预测结果从已有的观察值中选择一个最接近的均值进行匹配。 K_pmm=20表示从预测均值最近的 20 个观测值中随机选择一个作为插补值。</td>
    </tr>
    <tr>
      <td>history_callback</td>
      <td>function</td>
      <td>规定了是否需要返回操作记录。</td>
    </tr>
  </tbody>
</table></div>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="c1"># ===== 多重插补实现 =====
# 选择需要插补的数值列
</span><span class="n">impute_columns</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">price</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">minimum_nights</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">number_of_reviews</span><span class="sh">'</span><span class="p">,</span> 
                 <span class="sh">'</span><span class="s">reviews_per_month</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">calculated_host_listings_count</span><span class="sh">'</span><span class="p">,</span>
                 <span class="sh">'</span><span class="s">availability_365</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">number_of_reviews_ltm</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">last_review_days</span><span class="sh">'</span><span class="p">,</span>
                 <span class="sh">'</span><span class="s">ng_encoded</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">n_encoded</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">rt_encoded</span><span class="sh">'</span><span class="p">]</span>

<span class="c1"># 执行MICE插补
</span><span class="n">imp</span> <span class="o">=</span> <span class="nc">MICEData</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">impute_columns</span><span class="p">],</span> <span class="n">perturbation_method</span><span class="o">=</span><span class="sh">'</span><span class="s">gaussian</span><span class="sh">'</span><span class="p">,</span> <span class="n">k_pmm</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">imp</span><span class="p">.</span><span class="nf">update_all</span><span class="p">()</span>

<span class="c1"># 合并插补结果
</span><span class="n">imputed_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="nf">copy</span><span class="p">()</span>
<span class="n">imputed_data</span><span class="p">[</span><span class="n">impute_columns</span><span class="p">]</span> <span class="o">=</span> <span class="n">imp</span><span class="p">.</span><span class="n">data</span>
</pre></td></tr></tbody></table></code></div></div>

<p>然后是后处理阶段。</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre><span class="c1"># ===== 后处理阶段 =====
# 1. 恢复分类变量
</span><span class="n">imputed_data</span><span class="p">[[</span><span class="sh">'</span><span class="s">neighbourhood_group</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">neighbourhood</span><span class="sh">'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">geo_encoder</span><span class="p">.</span><span class="nf">inverse_transform</span><span class="p">(</span>
    <span class="n">imputed_data</span><span class="p">[[</span><span class="sh">'</span><span class="s">ng_encoded</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">n_encoded</span><span class="sh">'</span><span class="p">]])</span>
<span class="n">imputed_data</span><span class="p">[</span><span class="sh">'</span><span class="s">room_type</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">room_type_encoder</span><span class="p">.</span><span class="nf">inverse_transform</span><span class="p">(</span>
    <span class="n">imputed_data</span><span class="p">[[</span><span class="sh">'</span><span class="s">rt_encoded</span><span class="sh">'</span><span class="p">]]).</span><span class="nf">flatten</span><span class="p">()</span>

<span class="c1"># 2. 恢复last_review日期
</span><span class="n">imputed_data</span><span class="p">[</span><span class="sh">'</span><span class="s">last_review</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span>
    <span class="n">imputed_data</span><span class="p">[</span><span class="sh">'</span><span class="s">last_review</span><span class="sh">'</span><span class="p">].</span><span class="nf">isna</span><span class="p">(),</span>
    <span class="p">(</span><span class="n">max_date</span> <span class="o">-</span> <span class="n">pd</span><span class="p">.</span><span class="nf">to_timedelta</span><span class="p">(</span><span class="n">imputed_data</span><span class="p">[</span><span class="sh">'</span><span class="s">last_review_days</span><span class="sh">'</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="sh">'</span><span class="s">D</span><span class="sh">'</span><span class="p">)).</span><span class="n">dt</span><span class="p">.</span><span class="nf">strftime</span><span class="p">(</span><span class="sh">'</span><span class="s">%Y-%m-%d</span><span class="sh">'</span><span class="p">),</span>
    <span class="n">imputed_data</span><span class="p">[</span><span class="sh">'</span><span class="s">last_review</span><span class="sh">'</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># 3. 清理中间列
</span><span class="n">imputed_data</span> <span class="o">=</span> <span class="n">imputed_data</span><span class="p">.</span><span class="nf">drop</span><span class="p">([</span><span class="sh">'</span><span class="s">ng_encoded</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">n_encoded</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">rt_encoded</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">last_review_days</span><span class="sh">'</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">#价格异常值处理
</span><span class="n">imputed_data</span> <span class="o">=</span> <span class="n">imputed_data</span><span class="p">[(</span><span class="n">imputed_data</span><span class="p">[</span><span class="sh">'</span><span class="s">price</span><span class="sh">'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">imputed_data</span><span class="p">[</span><span class="sh">'</span><span class="s">price</span><span class="sh">'</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">)]</span>
<span class="c1"># 保存结果
</span><span class="n">imputed_data</span><span class="p">.</span><span class="nf">to_csv</span><span class="p">(</span><span class="sh">'</span><span class="s">imputed_data_FIX_full.csv</span><span class="sh">'</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="matplotlib"><span class="me-2">Matplotlib</span><a href="#matplotlib" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>最终还有一个绘图，这里用到了<code class="language-plaintext highlighter-rouge">matplotlib</code></p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="rouge-code"><pre><span class="c1"># 绘制价格分布对比图
</span><span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="n">plt</span><span class="p">.</span><span class="n">rcParams</span><span class="p">[</span><span class="sh">"</span><span class="s">font.sans-serif</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s">SimHei</span><span class="sh">"</span><span class="p">]</span>  <span class="c1"># 设置字体
</span><span class="n">plt</span><span class="p">.</span><span class="n">rcParams</span><span class="p">[</span><span class="sh">"</span><span class="s">axes.unicode_minus</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>  <span class="c1"># 正常显示负号
</span><span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># 原始数据分布
</span><span class="n">plt</span><span class="p">.</span><span class="nf">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">raw_data</span><span class="p">[</span><span class="sh">'</span><span class="s">price</span><span class="sh">'</span><span class="p">].</span><span class="nf">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2500</span><span class="p">))</span>  <span class="c1"># 直接限定数据范围
</span><span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">原始价格分布 (n=</span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">raw_data</span><span class="p">)</span><span class="si">}</span><span class="s">)</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Price (USD)</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">frequency</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2500</span><span class="p">)</span>  <span class="c1"># 双重保险设置显示范围[5,7](@ref)
</span>
<span class="c1"># 插补后数据分布
</span><span class="n">plt</span><span class="p">.</span><span class="nf">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">imputed_data</span><span class="p">[</span><span class="sh">'</span><span class="s">price</span><span class="sh">'</span><span class="p">].</span><span class="nf">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2500</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">插补后价格分布 (n=</span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">imputed_data</span><span class="p">)</span><span class="si">}</span><span class="s">)</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Price (USD)</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2500</span><span class="p">)</span>  <span class="c1"># 同步设置显示范围
</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">tight_layout</span><span class="p">()</span>  <span class="c1"># 自动调整子图间距
</span><span class="n">plt</span><span class="p">.</span><span class="nf">savefig</span><span class="p">(</span><span class="sh">'</span><span class="s">output_FIX.png</span><span class="sh">'</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="sh">'</span><span class="s">tight</span><span class="sh">'</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>这里要特别非常强调一个问题，matplotlib默认的中文绘图需要自己的电脑带有中文字体，否则会出现很多麻烦的问题。</p>

<p>我的环境是Windows11 23H2工作站版下的WSL2 Ubuntu24.02 LTSC，虽然系统已经是中文版，但并不带有中文字体。一开始我在这个问题上折腾了很久。<a href="https://zhuanlan.zhihu.com/p/566430362">百分百解决你的matplotlib画图中文乱码问题 - 知乎</a>，在这个文档的帮助下，得以解决问题，为了防止原文被删，这里引用一下原文：</p>

<blockquote>
  <h3 id="解决方案"><span class="me-2">解决方案</span><a href="#解决方案" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

  <ol>
    <li>首先<strong>删除你的缓存</strong>。找到你的缓存</li>
  </ol>

  <div class="language-text highlighter-rouge"><div class="code-header">
        <span data-label-text="Text"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>import matplotlib as mpl
print(mpl.get_cachedir())
# /Users/xiewenwen/.matplotlib
</pre></td></tr></tbody></table></code></div>  </div>

  <p>我的缓存文件夹是：/Users/xiewenwen/.matplotlib</p>

  <p>删除这个缓存文件夹：rm -rf /Users/xiewenwen/.matplotlib/*</p>

  <p>有评论说删除缓存就可以了，你也可以试一试。</p>

  <p>2.下载SeiHei.ttf字体放入~<strong>/.fonts</strong>目录下。</p>

  <p>或者复制这个链接下载</p>

  <div class="language-text highlighter-rouge"><div class="code-header">
        <span data-label-text="Text"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>http://139.199.170.86/downloads/SimHei.ttf
</pre></td></tr></tbody></table></code></div>  </div>

  <p>安装SimHei的命令：</p>

  <div class="language-text highlighter-rouge"><div class="code-header">
        <span data-label-text="Text"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>（1）cd ~/.fonts 。如果没有就mkdir ~/.fonts
（2）wget http://139.199.170.86/downloads/SimHei.ttf
（3）安装fc-cache的命令
   # 如果你是centos 
   sudo yum install fontconfig -y
   # 如果你是ubuntu
   sudo apt-get install fontconfig -y
   # 如果你是mac
   brew install fontconfig
（4）再执行 fc-cache -fv    刷新字体缓存
</pre></td></tr></tbody></table></code></div>  </div>
</blockquote>

<h3 id="随机森林"><span class="me-2">随机森林</span><a href="#随机森林" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>在最后一个问题中，我们使用了随机森林的方法来寻找最优解，随机森林核心参数如下：</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th style="text-align: left">参数</th>
      <th style="text-align: left">意义</th>
      <th style="text-align: left">调参建议</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">n_estimators</code></td>
      <td style="text-align: left">决策树的数量</td>
      <td style="text-align: left">增加树的数量提升稳定性，但计算成本增加（通常100-500）。</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">max_depth</code></td>
      <td style="text-align: left">单棵树的最大深度</td>
      <td style="text-align: left">过大导致过拟合，过小导致欠拟合（常用5-20）。</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">min_samples_leaf</code></td>
      <td style="text-align: left">叶节点所需最小样本数</td>
      <td style="text-align: left">增大可防止过拟合（常用1-10）。</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">max_features</code></td>
      <td style="text-align: left">每棵树分裂时考虑的特征数（默认<code class="language-plaintext highlighter-rouge">auto</code>）</td>
      <td style="text-align: left">减少特征数可降低方差，常用<code class="language-plaintext highlighter-rouge">sqrt(n_features)</code>。</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">n_jobs</code></td>
      <td style="text-align: left">并行计算使用的CPU核心数</td>
      <td style="text-align: left">设为-1使用全部核心加速训练。</td>
    </tr>
  </tbody>
</table></div>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
</pre></td><td class="rouge-code"><pre><span class="c1"># -*- coding: utf-8 -*-
</span><span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="n">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="n">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="n">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span><span class="p">,</span> <span class="n">mean_squared_error</span>
<span class="kn">from</span> <span class="n">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span>
<span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="n">plt</span><span class="p">.</span><span class="n">rcParams</span><span class="p">[</span><span class="sh">"</span><span class="s">font.sans-serif</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s">SimHei</span><span class="sh">"</span><span class="p">]</span>  <span class="c1"># 设置字体
</span><span class="n">plt</span><span class="p">.</span><span class="n">rcParams</span><span class="p">[</span><span class="sh">"</span><span class="s">axes.unicode_minus</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>  <span class="c1"># 正常显示负号
# --------------------------
# 数据预处理与收益参数计算
# --------------------------
</span><span class="k">def</span> <span class="nf">preprocess_data</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
    <span class="c1"># 加载数据
</span>    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    
    <span class="c1"># 计算入住率 (Occupancy Rate = 1 - availability_365/365)
</span>    <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">occupancy_rate</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">availability_365</span><span class="sh">'</span><span class="p">]</span> <span class="o">/</span> <span class="mi">365</span>
    
    <span class="c1"># 定义收益参数
</span>    <span class="c1"># 曼哈顿成本最高（参数最低），布鲁克林次之，其他区域更高
</span>    <span class="n">revenue_param_map</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">'</span><span class="s">Manhattan</span><span class="sh">'</span><span class="p">:</span><span class="mf">0.374669</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">Brooklyn</span><span class="sh">'</span><span class="p">:</span> <span class="mf">0.510500</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">Queens</span><span class="sh">'</span><span class="p">:</span> <span class="mf">0.470317</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">Bronx</span><span class="sh">'</span><span class="p">:</span> <span class="mf">0.504385</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">Staten Island</span><span class="sh">'</span><span class="p">:</span> <span class="mf">0.500000</span>
    <span class="p">}</span>
    <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">revenue_param</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">neighbourhood_group</span><span class="sh">'</span><span class="p">].</span><span class="nf">map</span><span class="p">(</span><span class="n">revenue_param_map</span><span class="p">)</span>
    
    <span class="c1"># 计算收益目标变量 (Revenue = Price * Occupancy Rate * Revenue Parameter)
</span>    <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">revenue</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">price</span><span class="sh">'</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">occupancy_rate</span><span class="sh">'</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">revenue_param</span><span class="sh">'</span><span class="p">]</span>
    
    <span class="c1"># 特征选择
</span>    <span class="n">features</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span>
        <span class="sh">'</span><span class="s">neighbourhood_group</span><span class="sh">'</span><span class="p">,</span>  <span class="c1"># 大区域分组
</span>        <span class="sh">'</span><span class="s">latitude</span><span class="sh">'</span><span class="p">,</span>             <span class="c1"># 纬度
</span>        <span class="sh">'</span><span class="s">longitude</span><span class="sh">'</span><span class="p">,</span>            <span class="c1"># 经度
</span>        <span class="sh">'</span><span class="s">room_type</span><span class="sh">'</span><span class="p">,</span>            <span class="c1"># 房源类型
</span>        <span class="sh">'</span><span class="s">minimum_nights</span><span class="sh">'</span><span class="p">,</span>       <span class="c1"># 最少入住天数
</span>        <span class="sh">'</span><span class="s">number_of_reviews</span><span class="sh">'</span><span class="p">,</span>    <span class="c1"># 累计评价数
</span>        <span class="sh">'</span><span class="s">reviews_per_month</span><span class="sh">'</span><span class="p">,</span>    <span class="c1"># 每月评价数（反映活跃度）
</span>        <span class="sh">'</span><span class="s">calculated_host_listings_count</span><span class="sh">'</span><span class="p">,</span>  <span class="c1"># 房东房源总数
</span>        <span class="sh">'</span><span class="s">availability_365</span><span class="sh">'</span><span class="p">,</span>     <span class="c1"># 可预订天数（用于计算入住率）
</span>        <span class="sh">'</span><span class="s">number_of_reviews_ltm</span><span class="sh">'</span><span class="p">,</span><span class="c1"># 近12个月评价数
</span>        <span class="sh">'</span><span class="s">price</span><span class="sh">'</span>                 <span class="c1"># 原始价格（作为可调节变量）
</span>    <span class="p">]]</span>
    
    <span class="c1"># 对分类变量进行独热编码
</span>    <span class="n">encoder</span> <span class="o">=</span> <span class="nc">OneHotEncoder</span><span class="p">(</span><span class="n">sparse_output</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="sh">'</span><span class="s">first</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">encoded_cats</span> <span class="o">=</span> <span class="n">encoder</span><span class="p">.</span><span class="nf">fit_transform</span><span class="p">(</span><span class="n">features</span><span class="p">[[</span><span class="sh">'</span><span class="s">neighbourhood_group</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">room_type</span><span class="sh">'</span><span class="p">]])</span>
    <span class="n">encoded_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span>
        <span class="n">encoded_cats</span><span class="p">,</span>
        <span class="n">columns</span><span class="o">=</span><span class="n">encoder</span><span class="p">.</span><span class="nf">get_feature_names_out</span><span class="p">([</span><span class="sh">'</span><span class="s">neighbourhood_group</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">room_type</span><span class="sh">'</span><span class="p">])</span>
    <span class="p">)</span>
    
    <span class="c1"># 合并数值型特征
</span>    <span class="n">numerical_features</span> <span class="o">=</span> <span class="n">features</span><span class="p">[[</span>
        <span class="sh">'</span><span class="s">latitude</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">longitude</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">minimum_nights</span><span class="sh">'</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">number_of_reviews</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">reviews_per_month</span><span class="sh">'</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">calculated_host_listings_count</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">number_of_reviews_ltm</span><span class="sh">'</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">price</span><span class="sh">'</span>
    <span class="p">]]</span>
    <span class="n">processed_features</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">concat</span><span class="p">([</span><span class="n">encoded_df</span><span class="p">,</span> <span class="n">numerical_features</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">df</span><span class="p">,</span> <span class="n">processed_features</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">revenue</span><span class="sh">'</span><span class="p">]</span>

<span class="c1"># --------------------------
# 随机森林建模与评估
# --------------------------
</span><span class="k">def</span> <span class="nf">build_rf_model</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="c1"># 划分训练集和测试集
</span>    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="nf">train_test_split</span><span class="p">(</span>
        <span class="n">features</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
    <span class="p">)</span>
    
    <span class="c1"># 初始化随机森林模型
</span>    <span class="n">model</span> <span class="o">=</span> <span class="nc">RandomForestRegressor</span><span class="p">(</span>
        <span class="n">n_estimators</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
        <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
    <span class="p">)</span>
    <span class="n">model</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    
    <span class="c1"># 模型评估
</span>    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">模型性能评估:</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">R² Score: </span><span class="si">{</span><span class="nf">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span><span class="si">:</span><span class="p">.</span><span class="mi">3</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">RMSE: </span><span class="si">{</span><span class="n">np</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="nf">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span><span class="si">:</span><span class="p">.</span><span class="mi">1</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="c1"># 可视化特征重要性
</span>    <span class="n">feat_importance</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">features</span><span class="p">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">feat_importance</span><span class="p">.</span><span class="nf">nlargest</span><span class="p">(</span><span class="mi">10</span><span class="p">).</span><span class="nf">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="sh">'</span><span class="s">barh</span><span class="sh">'</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sh">'</span><span class="s">特征重要性排名</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">savefig</span><span class="p">(</span><span class="sh">'</span><span class="s">特征重要性排名.png</span><span class="sh">'</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="sh">'</span><span class="s">tight</span><span class="sh">'</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">model</span>

<span class="c1"># --------------------------
# 价格优化器
# --------------------------
</span><span class="k">def</span> <span class="nf">optimize_pricing</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">sample_features</span><span class="p">,</span> <span class="n">original_price</span><span class="p">,</span> <span class="n">price_range</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    输入:
        - model: 训练好的随机森林模型
        - sample_features: 单个房源的特征数据（需包含除price外的所有特征）
        - original_price: 当前价格
        - price_range: 价格调整范围比例（默认±50%）
    输出:
        - optimal_price: 最大化收益的最优价格
        - max_revenue: 对应的预测收益
    </span><span class="sh">"""</span>
    <span class="c1"># 生成价格搜索空间（当前价格的50%~150%）
</span>    <span class="n">price_min</span> <span class="o">=</span> <span class="n">original_price</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">price_range</span><span class="p">)</span>
    <span class="n">price_max</span> <span class="o">=</span> <span class="n">original_price</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">price_range</span><span class="p">)</span>
    <span class="n">prices</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">linspace</span><span class="p">(</span><span class="n">price_min</span><span class="p">,</span> <span class="n">price_max</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    
    <span class="c1"># 复制特征并调整价格
</span>    <span class="n">test_data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">([</span><span class="n">sample_features</span><span class="p">]</span> <span class="o">*</span> <span class="nf">len</span><span class="p">(</span><span class="n">prices</span><span class="p">))</span>
    <span class="n">test_data</span><span class="p">[</span><span class="sh">'</span><span class="s">price</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">prices</span>
    
    <span class="c1"># 预测收益
</span>    <span class="n">revenues</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span>
    
    <span class="c1"># 找到最优价格
</span>    <span class="n">optimal_idx</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">argmax</span><span class="p">(</span><span class="n">revenues</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">prices</span><span class="p">[</span><span class="n">optimal_idx</span><span class="p">],</span> <span class="n">revenues</span><span class="p">[</span><span class="n">optimal_idx</span><span class="p">]</span>

<span class="c1"># --------------------------
# 主程序
# --------------------------
</span><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="c1"># 数据预处理
</span>    <span class="n">df</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="nf">preprocess_data</span><span class="p">(</span><span class="sh">"</span><span class="s">imputed_data_FIX_full.csv</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># 替换为实际文件路径
</span>    
    <span class="c1"># 训练模型
</span>    <span class="n">rf_model</span> <span class="o">=</span> <span class="nf">build_rf_model</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
    
    <span class="c1"># 示例：优化第100号房源价格
</span>    <span class="n">sample_idx</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">sample_data</span> <span class="o">=</span> <span class="n">features</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">sample_idx</span><span class="p">]</span>
    <span class="n">current_price</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">sample_idx</span><span class="p">][</span><span class="sh">'</span><span class="s">price</span><span class="sh">'</span><span class="p">]</span>
    
    <span class="n">optimal_price</span><span class="p">,</span> <span class="n">max_revenue</span> <span class="o">=</span> <span class="nf">optimize_pricing</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="n">rf_model</span><span class="p">,</span>
        <span class="n">sample_features</span><span class="o">=</span><span class="n">sample_data</span><span class="p">,</span>
        <span class="n">original_price</span><span class="o">=</span><span class="n">current_price</span>
    <span class="p">)</span>
    
    <span class="c1"># 打印结果
</span>    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">=== 价格优化结果 ===</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">当前价格: $</span><span class="si">{</span><span class="n">current_price</span><span class="si">:</span><span class="p">.</span><span class="mi">0</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">最优价格: $</span><span class="si">{</span><span class="n">optimal_price</span><span class="si">:</span><span class="p">.</span><span class="mi">0</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">预测收益提升: </span><span class="si">{</span><span class="p">((</span><span class="n">max_revenue</span> <span class="o">-</span> <span class="n">df</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">sample_idx</span><span class="p">][</span><span class="sh">'</span><span class="s">revenue</span><span class="sh">'</span><span class="p">])</span> <span class="o">/</span> <span class="n">df</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">sample_idx</span><span class="p">][</span><span class="sh">'</span><span class="s">revenue</span><span class="sh">'</span><span class="p">])</span><span class="si">:</span><span class="p">.</span><span class="mi">1</span><span class="o">%</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="c1"># 可视化价格-收益曲线
</span>    <span class="n">price_range</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">prices</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">linspace</span><span class="p">(</span><span class="n">current_price</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">price_range</span><span class="p">),</span> <span class="n">current_price</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">price_range</span><span class="p">),</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">test_data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">([</span><span class="n">sample_data</span><span class="p">]</span> <span class="o">*</span> <span class="nf">len</span><span class="p">(</span><span class="n">prices</span><span class="p">))</span>
    <span class="n">test_data</span><span class="p">[</span><span class="sh">'</span><span class="s">price</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">prices</span>

    <span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">prices</span><span class="p">,</span> <span class="n">rf_model</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="n">test_data</span><span class="p">))</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">axvline</span><span class="p">(</span><span class="n">optimal_price</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">red</span><span class="sh">'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="sh">'</span><span class="s">--</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="sh">"</span><span class="s">Price</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">"</span><span class="s">Predicted Revenue</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">"</span><span class="s">价格与收益关系曲线</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">savefig</span><span class="p">(</span><span class="sh">'</span><span class="s">价格与收益关系曲线.png</span><span class="sh">'</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="sh">'</span><span class="s">tight</span><span class="sh">'</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>


  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    
      <div class="post-meta mb-3">
        <i class="far fa-folder-open fa-fw me-1"></i>
        
          <a href="/categories/mathematics-modeling/">Mathematics Modeling</a>
      </div>
    

    <!-- tags -->
    
      <div class="post-tags">
        <i class="fa fa-tags fa-fw me-1"></i>
        
          <a
            href="/tags/math/"
            class="post-tag no-text-decoration"
          >math</a>
        
          <a
            href="/tags/python/"
            class="post-tag no-text-decoration"
          >python</a>
        
      </div>
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">Share</span>
  <span class="share-icons">
    
    
    

    

      

      <a href="https://twitter.com/intent/tweet?text=2025%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1%E7%AC%AC%E4%B8%80%E6%AC%A1%E6%A0%A1%E8%B5%9B%E5%A4%8D%E7%9B%98%20-%20lamaper&url=%2Fposts%2F25school1%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter">
        <i class="fa-fw fa-brands fa-square-x-twitter"></i>
      </a>
    

      

      <a href="https://www.facebook.com/sharer/sharer.php?title=2025%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1%E7%AC%AC%E4%B8%80%E6%AC%A1%E6%A0%A1%E8%B5%9B%E5%A4%8D%E7%9B%98%20-%20lamaper&u=%2Fposts%2F25school1%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook">
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    

      

      <a href="https://t.me/share/url?url=%2Fposts%2F25school1%2F&text=2025%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1%E7%AC%AC%E4%B8%80%E6%AC%A1%E6%A0%A1%E8%B5%9B%E5%A4%8D%E7%9B%98%20-%20lamaper" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram">
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="Copy link"
      data-title-succeed="Link copied successfully!"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>


            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted">
            <div class="access">
              <!-- Get 5 last posted/updated posts -->














  <section id="access-lastmod">
    <h2 class="panel-heading">Recently Updated</h2>
    <ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2">
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/CS61A/">UCB CS61A学习笔记</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/bit-ece-stm32/">BIT ECE实习之STM32开发</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/c-in-bit/">一些神奇的C语言题目</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/py-ssti/">Python SSTI研究</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/nodejs-vm-esc/">Node JS沙箱逃逸</a>
        </li>
      
    </ul>
  </section>
  <!-- #access-lastmod -->


              <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/web/">web</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ctf/">ctf</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/php/">php</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/algorithm/">algorithm</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/python/">python</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/arcgis/">arcgis</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/blogs/">blogs</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/c-c/">c/c++</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/coding/">coding</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/computer-science/">computer science</a>
      
    </div>
  </section>


            </div>

            
              
              






  <div class="toc-border-cover z-3"></div>
  <section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4">
    <h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2>
    <nav id="toc"></nav>
  </section>


            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->















  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
  

  

  

  

  

  











  <aside id="related-posts" aria-labelledby="related-label">
    <h3 class="mb-4" id="related-label">Further Reading</h3>
    <nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4">
      
        <article class="col">
          <a href="/posts/25tong/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1745164800"
  data-df="ll"
  
>
  Apr 21, 2025
</time>

              <h4 class="pt-0 my-2">2025统计建模复盘</h4>
              <div class="text-muted">
                <p>第一次统计建模尝试</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/py-ssti/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1760590461"
  data-df="ll"
  
>
  Oct 16, 2025
</time>

              <h4 class="pt-0 my-2">Python SSTI研究</h4>
              <div class="text-muted">
                <p>对CTF中基于Python（尤其是Jinja2）的模板引擎的注入研究</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/CS61A/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1751280300"
  data-df="ll"
  
>
  Jun 30, 2025
</time>

              <h4 class="pt-0 my-2">UCB CS61A学习笔记</h4>
              <div class="text-muted">
                <p>学习计算机程序的构造与解释</p>
              </div>
            </div>
          </a>
        </article>
      
    </nav>
  </aside>
  <!-- #related-posts -->


            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <a
      href="/posts/his-gis-sys/"
      class="btn btn-outline-primary"
      aria-label="Older"
    >
      <p>史纲课展示——第一次鸦片战争GIS</p>
    </a>
  

  
    <a
      href="/posts/25tong/"
      class="btn btn-outline-primary"
      aria-label="Newer"
    >
      <p>2025统计建模复盘</p>
    </a>
  
</nav>

            

            <!-- The Footer -->

<footer
  aria-label="Site Info"
  class="
    d-flex flex-column justify-content-center text-muted
    flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3
  "
>
  <p>©
    <time>2025</time>

    
      <a href="https://github.com/lamaper">lamaper</a>.
    

    
      <span
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author."
      >Some rights reserved.</span>
    
  </p>

  <p>Using the <a
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="v7.4.1"
        href="https://github.com/cotes2020/jekyll-theme-chirpy"
        target="_blank"
        rel="noopener"
      >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.
  </p>
</footer>

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center d-none">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/web/">web</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ctf/">ctf</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/php/">php</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/algorithm/">algorithm</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/python/">python</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/arcgis/">arcgis</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/blogs/">blogs</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/c-c/">c/c++</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/coding/">coding</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/computer-science/">computer science</a>
      
    </div>
  </section>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">A new version of content is available.</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      Update
    </button>
  </div>
</aside>

    

    <!-- Embedded scripts -->

    
      
      <!-- The comments switcher -->


    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  
  document.addEventListener('DOMContentLoaded', () => {
    SimpleJekyllSearch({
      searchInput: document.getElementById('search-input'),
      resultsContainer: document.getElementById('search-results'),
      json: '/assets/js/data/search.json',
      searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{content}</p>  </article>',
      noResultsText: '<p class="mt-5">Oops! No results found.</p>',
      templateMiddleware: function(prop, value, template) {
        if (prop === 'categories') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
          }
        }

        if (prop === 'tags') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
          }
        }
      }
    });
  });
</script>

  </body>
</html>

