<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="zh" >
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  ><!-- Setup Open Graph image -->

  

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="关于CHESS模型的一些学习" />
<meta name="author" content="lamaper" />
<meta property="og:locale" content="zh" />
<meta name="description" content="一段奇妙的科研经历" />
<meta property="og:description" content="一段奇妙的科研经历" />
<link rel="canonical" href="/posts/ai-sql/" />
<meta property="og:url" content="/posts/ai-sql/" />
<meta property="og:site_name" content="lamaper" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-02-19T16:24:23+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="关于CHESS模型的一些学习" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"lamaper","url":"https://github.com/lamaper/"},"dateModified":"2025-02-19T16:24:23+08:00","datePublished":"2025-02-19T16:24:23+08:00","description":"一段奇妙的科研经历","headline":"关于CHESS模型的一些学习","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/ai-sql/"},"url":"/posts/ai-sql/"}</script>
<!-- End Jekyll SEO tag -->


  <title>关于CHESS模型的一些学习 | lamaper
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="icon" type="image/png" href="/assets/img/favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/svg+xml" href="/assets/img/favicons/favicon.svg">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">

  <link rel="manifest" href="/assets/img/favicons/site.webmanifest">



  <!-- Resource Hints -->
  
    
      
        <link rel="preconnect" href="https://fonts.googleapis.com" >
      
        <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
      
    
      
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      
        <link rel="dns-prefetch" href="https://fonts.gstatic.com" >
      
    
      
        <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      
        <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
      
    
  

  <!-- Bootstrap -->
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css">
  

  <!-- Theme style -->
  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  <!-- Web Font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css">

  <!-- 3rd-party Dependencies -->

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.36.4/dist/tocbot.min.css">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css">
  

  
    <!-- Image Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css">
  

  <!-- Scripts -->

  <script src="/assets/js/dist/theme.min.js"></script>

  <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->


  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  



  <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.18/dayjs.min.js,npm/dayjs@1.11.18/locale/en.js,npm/dayjs@1.11.18/plugin/relativeTime.js,npm/dayjs@1.11.18/plugin/localizedFormat.js,npm/tocbot@4.36.4/dist/tocbot.min.js,npm/mermaid@11.12.0/dist/mermaid.min.js"></script>







<script defer src="/assets/js/dist/post.min.js"></script>


  <!-- MathJax -->
  <script src="/assets/js/data/mathjax.js"></script>
  <script async src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-chtml.js"></script>


<!-- Pageviews -->

  

  



  

  <!-- A placeholder to allow defining custom metadata -->

</head>


  <body>
    <!-- The Side Bar -->

<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle"><img src="https://avatars.githubusercontent.com/u/108182318?v=4" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a>

    <a class="site-title d-block" href="/">lamaper</a>
    <p class="site-subtitle fst-italic mb-0">Web / CTF / Coding</p>
  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>HOME</span>
        </a>
      </li>
      <!-- the real tabs -->
      
        <li class="nav-item">
          <a href="/categories/" class="nav-link">
            <i class="fa-fw fas fa-stream"></i>
            

            <span>CATEGORIES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/tags/" class="nav-link">
            <i class="fa-fw fas fa-tags"></i>
            

            <span>TAGS</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/archives/" class="nav-link">
            <i class="fa-fw fas fa-archive"></i>
            

            <span>ARCHIVES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/about/" class="nav-link">
            <i class="fa-fw fas fa-info-circle"></i>
            

            <span>ABOUT</span>
          </a>
        </li>
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    
      <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle">
        <i class="fas fa-adjust"></i>
      </button>

      
        <span class="icon-border"></span>
      
    

    

      
        <a
          href="https://github.com/lamaper"
          aria-label="github"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-github"></i>
        </a>
      
    

      
        <a
          href="javascript:location.href = 'mailto:' + ['lamaper','qq.com'].join('@')"
          aria-label="email"
          

          

          

          
        >
          <i class="fas fa-envelope"></i>
        </a>
      
    
          
        

      
        <a
          href="/feed.xml"
          aria-label="rss"
          

          

          

          
        >
          <i class="fas fa-rss"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar">
  <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/">Home</a>
            </span>

          
        
          
        
          
            
              <span>关于CHESS模型的一些学习</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      Post
    </div>

    <button type="button" id="search-trigger" class="btn btn-link" aria-label="Search">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search id="search" class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="Search..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->





<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  




<!-- return -->










<article class="px-1" data-toc="true">
  <header>
    <h1 data-toc-skip>关于CHESS模型的一些学习</h1>
    
      <p class="post-desc fw-light mb-4">一段奇妙的科研经历</p>
    

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        Posted
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1739953463"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  Feb 19, 2025
</time>

      </span>

      <!-- lastmod date -->
      

      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          By

          <em>
            
              
                <a href="https://github.com/lamaper/">lamaper</a>
                
              
            
          </em>
        </span>

        <div>
          <!-- pageviews -->
          

          <!-- read time -->
          <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="3216 words"
>
  <em>17 min</em> read</span>

        </div>
      </div>
    </div>
  </header>

  
    <div id="toc-bar" class="d-flex align-items-center justify-content-between invisible">
      <span class="label text-truncate">关于CHESS模型的一些学习</span>
      <button type="button" class="toc-trigger btn me-1">
        <i class="fa-solid fa-list-ul fa-fw"></i>
      </button>
    </div>

    <button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm">
      <span class="label ps-2 pe-1">Contents</span>
      <i class="fa-solid fa-angle-right fa-fw"></i>
    </button>

    <dialog id="toc-popup" class="p-0">
      <div class="header d-flex flex-row align-items-center justify-content-between">
        <div class="label text-truncate py-2 ms-4">关于CHESS模型的一些学习</div>
        <button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75">
          <i class="fas fa-close"></i>
        </button>
      </div>
      <div id="toc-popup-content" class="px-4 py-3 pb-4"></div>
    </dialog>
  

  <div class="content">
    <h3 id="chess的原理"><span class="me-2">CHESS的原理</span><a href="#chess的原理" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>CHESS论文：<a href="https://arxiv.org/abs/2405.16755">[2405.16755] CHESS: Contextual Harnessing for Efficient SQL Synthesis</a></p>

<h4 id="chess-的实现过程"><span class="me-2">CHESS 的实现过程</span><a href="#chess-的实现过程" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<h5 id="1information-retriever-ir---信息检索器"><span class="me-2">（1）Information Retriever (IR) - 信息检索器</span><a href="#1information-retriever-ir---信息检索器" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5>

<p>从数据库模式中提取与问题相关的实体和上下文。</p>

<blockquote>
  <p>The Information Retriever (IR) agent aims to retrieve the relevant entities (values in the database) and context (schema descriptions provided in the database catalog). To achieve this, we present scalable and efficient methods using locality-sensitive hashing to retrieve database values from millions of rows, leveraging keyword detection, and vector databases to extract contextual information from database catalogs. Our approach utilizes both semantic and syntactic similarities between the database content and the user’s query to enhance the retrieval quality.</p>
</blockquote>

<h5 id="2schema-selector-ss---模式选择器"><span class="me-2">（2）Schema Selector (SS) - 模式选择器</span><a href="#2schema-selector-ss---模式选择器" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5>

<p>进一步筛选出与问题最相关的表和列。</p>

<blockquote>
  <p>The goal of the Schema Selector (SS) agent is to reduce the schema size by selecting only the  necessary tables and columns required for generating the SQLquery. To achieve this, the SS agent is equipped with three tools, filter column, select tables, and select columns.</p>
</blockquote>

<h5 id="3candidate-generator-cg---候选生成器"><span class="me-2">（3）Candidate Generator (CG) - 候选生成器</span><a href="#3candidate-generator-cg---候选生成器" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5>

<p>生成多个候选 SQL 查询。</p>

<blockquote>
  <p>The Candidate Generator (CG) is responsible for synthesizing SQL query that answers the question asked from the database. To accomplish this, the CG agent first calls the generate candidate query tool to generate candidate queries. It then executes these candidates on the database, checks the result, and identifies any faulty queries (those containing syntactic errors or empty result). For each faulty candidate, the agent repeatedly attempts to revise the query, until the issue is resolved or a maximum number of allowed revisions is reached.</p>
</blockquote>

<h5 id="4unit-tester-ut---单元测试器"><span class="me-2">（4）Unit Tester (UT) - 单元测试器</span><a href="#4unit-tester-ut---单元测试器" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5>

<p>功能：通过自然语言单元测试评估生成的 SQL 查询。</p>

<blockquote>
  <p>The Unit Tester (UT) agent is responsible for selecting the most accurate SQL query from the pool of candidates generated by the CG agent. UT identifies the best candidate by 1) generating multiple unit tests that highlight differences between the candidate queries and 2) evaluating the candidates against these unit tests. It then assigns a score to each query based on the number of unit tests it passes, selecting the top-scoring candidate as the final SQL query for the given question.</p>
</blockquote>

<h3 id="实例分析"><span class="me-2">实例分析</span><a href="#实例分析" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>以california school 0为例，在bird测试集中:</p>

<div class="language-json highlighter-rouge"><div class="code-header">
        <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
    </span><span class="nl">"question_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"db_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"california_schools"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"question"</span><span class="p">:</span><span class="w"> </span><span class="s2">"What is the highest eligible free rate for K-12 students in the schools in Alameda County?"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"evidence"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Eligible free rate for K-12 = `Free Meal Count (K-12)` / `Enrollment (K-12)`"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"SQL"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SELECT `Free Meal Count (K-12)` / `Enrollment (K-12)` FROM frpm WHERE `County Name` = 'Alameda' ORDER BY (CAST(`Free Meal Count (K-12)` AS REAL) / `Enrollment (K-12)`) DESC LIMIT 1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"difficulty"</span><span class="p">:</span><span class="w"> </span><span class="s2">"simple"</span><span class="w">
  </span><span class="p">}</span><span class="err">,</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>“question_id”是测试集问题编号，该测试集一共有1534个问题</li>
  <li>“db_id”是数据库名称</li>
  <li>“evidence”是给AI的提示，用于辅助生成结果</li>
  <li>“SQL”是标准查询语句，用于获取正确的查询结果</li>
  <li>“difficulty”是BIRD给出的问题难度评级，”simple”&lt;”moderate”&lt;”challenging”</li>
</ul>

<p>通过<code class="language-plaintext highlighter-rouge">california_school_0.json</code>与<code class="language-plaintext highlighter-rouge">california_school_0.log</code>逐级分析：</p>

<p>首先用户给出提示词，在log中有记录：</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
</pre></td><td class="rouge-code"><pre>############################## Human at step revise_sql ##############################

Objective: Your objective is to make sure a query follows the database admin instructions and use the correct conditions.

Database Schema:    
CREATE TABLE frpm
(
	CDSCode TEXT not null primary key,
	`Academic Year` TEXT null,
	`County Code` TEXT null,
	`District Code` INTEGER null,
	`School Code` TEXT null,
	`County Name` TEXT null, -- examples: `Alameda`
	`District Name` TEXT null,
	`School Name` TEXT null, -- examples: `Alameda County Community`, `Alameda High`
	`District Type` TEXT null,
	`School Type` TEXT null,
	`Educational Option Type` TEXT null,
	`NSLP Provision Status` TEXT null,
	`Charter School (Y/N)` INTEGER null,
	`Charter School Number` TEXT null,
	`Charter Funding Type` TEXT null,
	IRC INTEGER null,
	`Low Grade` TEXT null,
	`High Grade` TEXT null,
	`Enrollment (K-12)` REAL null, -- description: Enrollment (K-12)
	`Free Meal Count (K-12)` REAL null, -- description: Free Meal Count (K-12)
	`Percent (%) Eligible Free (K-12)` REAL null,
	`FRPM Count (K-12)` REAL null, -- description: Free or Reduced Price Meal Count (K-12)
	`Percent (%) Eligible FRPM (K-12)` REAL null,
	`Enrollment (Ages 5-17)` REAL null, -- description: Enrollment (Ages 5-17)
	`Free Meal Count (Ages 5-17)` REAL null, -- description: Free Meal Count (Ages 5-17)
	`Percent (%) Eligible Free (Ages 5-17)` REAL null,
	`FRPM Count (Ages 5-17)` REAL null,
	`Percent (%) Eligible FRPM (Ages 5-17)` REAL null,
	`2013-14 CALPADS Fall 1 Certification Status` INTEGER null,
	foreign key (CDSCode) references schools (CDSCode),
);

CREATE TABLE satscores
(
	cds TEXT not null primary key,
	rtype TEXT not null,
	sname TEXT null, -- examples: `Alameda High`
	dname TEXT null, -- examples: `Alameda Unified`
	cname TEXT null, -- examples: `Alameda`
	enroll12 INTEGER not null,
	NumTstTakr INTEGER not null,
	AvgScrRead INTEGER null,
	AvgScrMath INTEGER null,
	AvgScrWrite INTEGER null,
	NumGE1500 INTEGER null,
	foreign key (cds) references schools (CDSCode),
);

CREATE TABLE schools
(
	CDSCode TEXT not null primary key,
	NCESDist TEXT null,
	NCESSchool TEXT null,
	StatusType TEXT not null,
	County TEXT not null, -- examples: `Alameda`
	District TEXT not null, -- examples: `Alameda County Office of Education`
	School TEXT null, -- examples: `Alameda County Community`, `Alameda High`
	Street TEXT null,
	StreetAbr TEXT null,
	City TEXT null, -- examples: `Alameda`
	Zip TEXT null,
	State TEXT null,
	MailStreet TEXT null,
	MailStrAbr TEXT null,
	MailCity TEXT null, -- examples: `Alameda`
	MailZip TEXT null,
	MailState TEXT null,
	Phone TEXT null,
	Ext TEXT null,
	Website TEXT null,
	OpenDate DATE null, -- examples: `1997-09-01`
	ClosedDate DATE null, -- examples: `1984-07-24`
	Charter INTEGER null,
	CharterNum TEXT null,
	FundingType TEXT null,
	DOC TEXT not null,
	DOCType TEXT not null,
	SOC TEXT null,
	SOCType TEXT null,
	EdOpsCode TEXT null,
	EdOpsName TEXT null,
	EILCode TEXT null,
	EILName TEXT null,
	GSoffered TEXT null, -- examples: `K-12`
	GSserved TEXT null, -- examples: `K-12`
	Virtual TEXT null,
	Magnet INTEGER null,
	Latitude REAL null,
	Longitude REAL null,
	AdmFName1 TEXT null,
	AdmLName1 TEXT null, -- examples: `Free`
	AdmEmail1 TEXT null,
	AdmFName2 TEXT null,
	AdmLName2 TEXT null,
	AdmEmail2 TEXT null,
	AdmFName3 TEXT null,
	AdmLName3 TEXT null,
	AdmEmail3 TEXT null,
	LastUpdate DATE not null, -- examples: `2015-07-01`
);

Database admin instructions:
1. When you need to find the highest or lowest values based on a certain condition, using ORDER BY + LIMIT 1 is prefered over using MAX/MIN within sub queries.
2. If predicted query includes an ORDER BY clause to sort the results, you should only include the column(s) used for sorting in the SELECT clause if the question specifically ask for them. Otherwise, omit these columns from the SELECT.
3. If the question doesn't specify exactly which columns to select, between name column and id column, prefer to select id column.
4. Make sure you only output the information that is asked in the question. If the question asks for a specific column, make sure to only include that column in the SELECT clause, nothing more.
5. Predicted query should return all of the information asked in the question without any missing or extra information.
7. For key phrases mentioned in the question, we have provided the most similar values within the columns denoted by "-- examples" in front of the corresponding column names. This is a crucial hint indicating the correct columns to use for your SQL query.
8. No matter of how many things the question asks, you should only return one SQL query as the answer having all the information asked in the question, seperated by a comma.
9. Using || ' ' ||  to concatenate is string is banned and using that is punishable by death. Never concatenate columns in the SELECT clause.
10. If you are joining multiple tables, make sure to use alias names for the tables and use the alias names to reference the columns in the query. Use T1, T2, T3, ... as alias names.
11. If you are doing a logical operation on a column, such as mathematical operations and sorting, make sure to filter null values within those columns.
12. When ORDER BY is used, just include the column name in the ORDER BY in the SELECT clause when explicitly asked in the question. Otherwise, do not include the column name in the SELECT clause.


Value Alameda that you used in the query appears in the column City of table schools.
Value Alameda that you used in the query appears in the column MailCity of table schools.
Value Alameda that you used in the query appears in the column County of table schools.
Value Alameda that you used in the query appears in the column cname of table satscores.



Question:
What is the highest eligible free rate for K-12 students in the schools in Alameda County?

Hint:
Eligible free rate for K-12 = `Free Meal Count (K-12)` / `Enrollment (K-12)`

Predicted query:
SELECT MAX(CAST(`Free Meal Count (K-12)` AS REAL) / `Enrollment (K-12)`) FROM frpm WHERE `County Name` = 'Alameda' 

Query result:
[(1.0,)]

Please respond with a JSON object structured as follows (if the sql query is correct, return the query as it is):

{
    "chain_of_thought_reasoning": "Your thought process on how you arrived at the solution. You don't need to explain the instructions that are satisfied.",
    "revised_SQL": "Your revised SQL query."
}

Take a deep breath and think step by step to find the correct sqlite SQL query. If you follow all the instructions and generate the correct query, I will give you 1 million dollars.
</pre></td></tr></tbody></table></code></div></div>

<p>AI通过分析用户的要求，得到如下结果：</p>

<div class="language-json highlighter-rouge"><div class="code-header">
        <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="err">##############################</span><span class="w"> </span><span class="err">AI</span><span class="w"> </span><span class="err">at</span><span class="w"> </span><span class="err">step</span><span class="w"> </span><span class="err">revise_sql</span><span class="w"> </span><span class="err">##############################</span><span class="w">

</span><span class="p">{</span><span class="w">
    </span><span class="nl">"chain_of_thought_reasoning"</span><span class="p">:</span><span class="w"> </span><span class="s2">"To find the highest eligible free rate for K-12 students in schools located in Alameda County, we need to calculate the ratio of `Free Meal Count (K-12)` to `Enrollment (K-12)` for each school and then determine the maximum value of this ratio. The database schema indicates that these fields are located in the `frpm` table, and the county information is stored in the `County Name` column. The query filters records where `County Name` is 'Alameda' to focus on schools in Alameda County. The calculation for the eligible free rate is performed by dividing `Free Meal Count (K-12)` by `Enrollment (K-12)`, and the maximum value of this calculation is obtained using the MAX function. The query correctly handles the division by casting `Free Meal Count (K-12)` to REAL to ensure accurate division results. The query also ensures that only the maximum value of the calculated ratio is returned, adhering to the instruction to output only the information asked in the question."</span><span class="p">,</span><span class="w">
    </span><span class="nl">"revised_SQL"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SELECT MAX(CAST(`Free Meal Count (K-12)` AS REAL) / `Enrollment (K-12)`) FROM frpm WHERE `County Name` = 'Alameda'"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<blockquote>
  <p>To find the highest eligible free rate for K-12 students in schools located in Alameda County, we need to calculate the ratio of <code class="language-plaintext highlighter-rouge">Free Meal Count (K-12)</code> to <code class="language-plaintext highlighter-rouge">Enrollment (K-12)</code> for each school and then determine the maximum value of this ratio.</p>

  <p>The database schema indicates that these fields are located in the <code class="language-plaintext highlighter-rouge">frpm</code> table, and the county information is stored in the <code class="language-plaintext highlighter-rouge">County Name</code> column.</p>

  <p>The query filters records where <code class="language-plaintext highlighter-rouge">County Name</code> is ‘Alameda’ to focus on schools in Alameda County.</p>

  <p>The calculation for the eligible free rate is performed by dividing <code class="language-plaintext highlighter-rouge">Free Meal Count (K-12)</code> by <code class="language-plaintext highlighter-rouge">Enrollment (K-12)</code>, and the maximum value of this calculation is obtained using the MAX function.</p>

  <p>The query correctly handles the division by casting <code class="language-plaintext highlighter-rouge">Free Meal Count (K-12)</code> to REAL to ensure accurate division results.</p>

  <p>The query also ensures that only the maximum value of the calculated ratio is returned, adhering to the instruction to output only the information asked in the question.</p>
</blockquote>

<p>AI给出的结果写入到了revised_SQL中：</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="k">MAX</span><span class="p">(</span><span class="k">CAST</span><span class="p">(</span><span class="nv">`Free Meal Count (K-12)`</span> <span class="k">AS</span> <span class="nb">REAL</span><span class="p">)</span> <span class="o">/</span> <span class="nv">`Enrollment (K-12)`</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">frpm</span> <span class="k">WHERE</span> <span class="nv">`County Name`</span> <span class="o">=</span> <span class="s1">'Alameda'</span>
</pre></td></tr></tbody></table></code></div></div>

<p>同一个问题会被询问2-3次，之后程序对进行评判回答是否正确：</p>

<div class="language-json highlighter-rouge"><div class="code-header">
        <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="rouge-code"><pre><span class="err">##############################</span><span class="w"> </span><span class="err">Admin</span><span class="w"> </span><span class="err">at</span><span class="w"> </span><span class="err">step</span><span class="w"> </span><span class="err">Evaluation</span><span class="w"> </span><span class="err">##############################</span><span class="w">

</span><span class="p">{</span><span class="w">
    </span><span class="nl">"node_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"evaluate_sql"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"evaluation_for"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nl_to_sql"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"exec_res"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nl">"exec_err"</span><span class="p">:</span><span class="w"> </span><span class="s2">"--"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Question"</span><span class="p">:</span><span class="w"> </span><span class="s2">"What is the highest eligible free rate for K-12 students in the schools in Alameda County?"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Evidence"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Eligible free rate for K-12 = `Free Meal Count (K-12)` / `Enrollment (K-12)`"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"GOLD_SQL"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SELECT `Free Meal Count (K-12)` / `Enrollment (K-12)` FROM frpm WHERE `County Name` = 'Alameda' ORDER BY (CAST(`Free Meal Count (K-12)` AS REAL) / `Enrollment (K-12)`) DESC LIMIT 1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"PREDICTED_SQL"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SELECT MAX(CAST(`Free Meal Count (K-12)` AS REAL) / `Enrollment (K-12)`) FROM frpm WHERE `County Name` = 'Alameda' "</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="err">##############################</span><span class="w"> </span><span class="err">Admin</span><span class="w"> </span><span class="err">at</span><span class="w"> </span><span class="err">step</span><span class="w"> </span><span class="err">Evaluation</span><span class="w"> </span><span class="err">##############################</span><span class="w">

</span><span class="p">{</span><span class="w">
    </span><span class="nl">"node_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"evaluate_sql"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"evaluation_for"</span><span class="p">:</span><span class="w"> </span><span class="s2">"revise_sql"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"exec_res"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nl">"exec_err"</span><span class="p">:</span><span class="w"> </span><span class="s2">"--"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Question"</span><span class="p">:</span><span class="w"> </span><span class="s2">"What is the highest eligible free rate for K-12 students in the schools in Alameda County?"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Evidence"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Eligible free rate for K-12 = `Free Meal Count (K-12)` / `Enrollment (K-12)`"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"GOLD_SQL"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SELECT `Free Meal Count (K-12)` / `Enrollment (K-12)` FROM frpm WHERE `County Name` = 'Alameda' ORDER BY (CAST(`Free Meal Count (K-12)` AS REAL) / `Enrollment (K-12)`) DESC LIMIT 1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"PREDICTED_SQL"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SELECT MAX(CAST(`Free Meal Count (K-12)` AS REAL) / `Enrollment (K-12)`) FROM frpm WHERE `County Name` = 'Alameda'"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p>其中：</p>

<ul>
  <li>“GOLD_SQL”是在BIRD数据集中出现的标准答案</li>
  <li>“PREDICTED_SQL”是AI产生的答案</li>
  <li>“exec_res”是判断结果，如果结果正确则返回1，错误则返回0</li>
  <li>“exec_err”是产生错误的原因，如果结果正确则返回”–”</li>
  <li>“evaluation_for”是状态，<strong><code class="language-plaintext highlighter-rouge">evaluation_for: nl_to_sql</code></strong> 表示当前评估的目标是检查自然语言到 SQL 转换的准确性；<strong><code class="language-plaintext highlighter-rouge">evaluation_for: revise_sql</code></strong> 表示当前评估的目标是检查对原始 SQL 查询的修正是否正确。</li>
</ul>

<p>下面是一个出现错误但最后被修正的日志：</p>

<div class="language-json highlighter-rouge"><div class="code-header">
        <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="rouge-code"><pre><span class="err">##############################</span><span class="w"> </span><span class="err">Admin</span><span class="w"> </span><span class="err">at</span><span class="w"> </span><span class="err">step</span><span class="w"> </span><span class="err">Evaluation</span><span class="w"> </span><span class="err">##############################</span><span class="w">

</span><span class="p">{</span><span class="w">
    </span><span class="nl">"node_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"evaluate_sql"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"evaluation_for"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nl_to_sql"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"exec_res"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"exec_err"</span><span class="p">:</span><span class="w"> </span><span class="s2">"incorrect answer"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Question"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Please list the lowest three eligible free rates for students aged 5-17 in continuation schools."</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Evidence"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Eligible free rates for students aged 5-17 = `Free Meal Count (Ages 5-17)` / `Enrollment (Ages 5-17)`"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"GOLD_SQL"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SELECT `Free Meal Count (Ages 5-17)` / `Enrollment (Ages 5-17)` FROM frpm WHERE `Educational Option Type` = 'Continuation School' AND `Free Meal Count (Ages 5-17)` / `Enrollment (Ages 5-17)` IS NOT NULL ORDER BY `Free Meal Count (Ages 5-17)` / `Enrollment (Ages 5-17)` ASC LIMIT 3"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"PREDICTED_SQL"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SELECT T2.`Free Meal Count (Ages 5-17)` / T2.`Enrollment (Ages 5-17)` FROM schools AS T1 INNER JOIN frpm AS T2 ON T1.CDSCode = T2.CDSCode WHERE T2.`Educational Option Type` = 'Continuation School' AND T2.`Enrollment (Ages 5-17)` &gt; 0 ORDER BY T2.`Free Meal Count (Ages 5-17)` / T2.`Enrollment (Ages 5-17)` ASC LIMIT 3 "</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="err">##############################</span><span class="w"> </span><span class="err">Admin</span><span class="w"> </span><span class="err">at</span><span class="w"> </span><span class="err">step</span><span class="w"> </span><span class="err">Evaluation</span><span class="w"> </span><span class="err">##############################</span><span class="w">

</span><span class="p">{</span><span class="w">
    </span><span class="nl">"node_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"evaluate_sql"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"evaluation_for"</span><span class="p">:</span><span class="w"> </span><span class="s2">"revise_sql"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"exec_res"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nl">"exec_err"</span><span class="p">:</span><span class="w"> </span><span class="s2">"--"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Question"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Please list the lowest three eligible free rates for students aged 5-17 in continuation schools."</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Evidence"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Eligible free rates for students aged 5-17 = `Free Meal Count (Ages 5-17)` / `Enrollment (Ages 5-17)`"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"GOLD_SQL"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SELECT `Free Meal Count (Ages 5-17)` / `Enrollment (Ages 5-17)` FROM frpm WHERE `Educational Option Type` = 'Continuation School' AND `Free Meal Count (Ages 5-17)` / `Enrollment (Ages 5-17)` IS NOT NULL ORDER BY `Free Meal Count (Ages 5-17)` / `Enrollment (Ages 5-17)` ASC LIMIT 3"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"PREDICTED_SQL"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SELECT T2.`Free Meal Count (Ages 5-17)` / T2.`Enrollment (Ages 5-17)` AS EligibleFreeRate FROM schools AS T1 INNER JOIN frpm AS T2 ON T1.CDSCode = T2.CDSCode WHERE T1.EdOpsName = 'Continuation School' AND T2.`Enrollment (Ages 5-17)` &gt; 0 AND T2.`Free Meal Count (Ages 5-17)` IS NOT NULL AND T2.`Enrollment (Ages 5-17)` IS NOT NULL ORDER BY EligibleFreeRate ASC LIMIT 3"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p>在所给的<code class="language-plaintext highlighter-rouge">error_logs</code>中，出错的回答日志被筛选出，可以通过检索<strong><code class="language-plaintext highlighter-rouge">chain_of_thought_reasoning</code></strong>查询思维链从而尝试找出失误的原因。</p>

<p>此外，论文从29页开始，给出了一些错误回答与错误原因：</p>

<h3 id="failed_summaryjson"><span class="me-2">failed_summary.json</span><a href="#failed_summaryjson" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>CHESS项目给出了他们在运行BIRD测试集时产生的中间结果，存放在<a href="https://github.com/ShayanTalaei/CHESS/blob/chess-v1/results/chess_on_dev.zip">CHESS/results/chess_on_dev.zip at chess-v1 · ShayanTalaei/CHESS</a>，经过合并，所有产生失误的数据被单独筛选出来，放入<code class="language-plaintext highlighter-rouge">failed_summary.json</code>中。</p>

<p>为了方便查找与定位，所有产生失误的数据都被添加了单独的标签<code class="language-plaintext highlighter-rouge">failure_annotations</code>，可以快速查找标签以定位问题产生的原因。</p>

<p>如：</p>

<div class="language-json highlighter-rouge"><div class="code-header">
        <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre><span class="w">                </span><span class="nl">"missing_table_status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"success"</span><span class="err">,</span><span class="w">
                </span><span class="nl">"missing_tables"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="err">,</span><span class="w">
                </span><span class="nl">"missing_column_status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"missing_column"</span><span class="err">,</span><span class="w">
                </span><span class="nl">"missing_columns"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="s2">"'schools'.'county'"</span><span class="w">
                </span><span class="p">]</span><span class="err">,</span><span class="w">
                </span><span class="nl">"correct_columns"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"frpm"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                        </span><span class="s2">"School Name"</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"cdscode"</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"High Grade"</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"Low Grade"</span><span class="w">
                    </span><span class="p">],</span><span class="w">
                    </span><span class="nl">"schools"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                        </span><span class="s2">"cdscode"</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"county"</span><span class="w">
                    </span><span class="p">]</span><span class="w">
                </span><span class="p">}</span><span class="err">,</span><span class="w">
                </span><span class="nl">"failure_annotations"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="s2">"Field 'missing_column_status' failed with value: missing_column"</span><span class="w">
                </span><span class="p">]</span><span class="w">
            </span><span class="p">}</span><span class="err">,</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p>产生了”missing_column”问题</p>

<p>又如：</p>

<div class="language-json highlighter-rouge"><div class="code-header">
        <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="w">            </span><span class="p">{</span><span class="w">
                </span><span class="nl">"node_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"nl_to_sql"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"error"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"error"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;class 'TypeError'&gt;: &lt;'NoneType' object is not subscriptable&gt;"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"failure_annotations"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="s2">"Field 'status' failed with value: error"</span><span class="w">
                </span><span class="p">]</span><span class="w">
            </span><span class="p">}</span><span class="err">,</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p>在”nl_to_sql”环节发生错误。</p>

  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    
      <div class="post-meta mb-3">
        <i class="far fa-folder-open fa-fw me-1"></i>
        
          <a href="/categories/blogs/">Blogs</a>
      </div>
    

    <!-- tags -->
    
      <div class="post-tags">
        <i class="fa fa-tags fa-fw me-1"></i>
        
          <a
            href="/tags/ai/"
            class="post-tag no-text-decoration"
          >ai</a>
        
          <a
            href="/tags/chess/"
            class="post-tag no-text-decoration"
          >chess</a>
        
      </div>
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">Share</span>
  <span class="share-icons">
    
    
    

    

      

      <a href="https://twitter.com/intent/tweet?text=%E5%85%B3%E4%BA%8ECHESS%E6%A8%A1%E5%9E%8B%E7%9A%84%E4%B8%80%E4%BA%9B%E5%AD%A6%E4%B9%A0%20-%20lamaper&url=%2Fposts%2Fai-sql%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter">
        <i class="fa-fw fa-brands fa-square-x-twitter"></i>
      </a>
    

      

      <a href="https://www.facebook.com/sharer/sharer.php?title=%E5%85%B3%E4%BA%8ECHESS%E6%A8%A1%E5%9E%8B%E7%9A%84%E4%B8%80%E4%BA%9B%E5%AD%A6%E4%B9%A0%20-%20lamaper&u=%2Fposts%2Fai-sql%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook">
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    

      

      <a href="https://t.me/share/url?url=%2Fposts%2Fai-sql%2F&text=%E5%85%B3%E4%BA%8ECHESS%E6%A8%A1%E5%9E%8B%E7%9A%84%E4%B8%80%E4%BA%9B%E5%AD%A6%E4%B9%A0%20-%20lamaper" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram">
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="Copy link"
      data-title-succeed="Link copied successfully!"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>


            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted">
            <div class="access">
              <!-- Get 5 last posted/updated posts -->














  <section id="access-lastmod">
    <h2 class="panel-heading">Recently Updated</h2>
    <ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2">
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/CS61A/">UCB CS61A学习笔记</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/bit-ece-stm32/">BIT ECE实习之STM32开发</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/c-in-bit/">一些神奇的C语言题目</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/py-ssti/">Python SSTI研究</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/nodejs-vm-esc/">Node JS沙箱逃逸</a>
        </li>
      
    </ul>
  </section>
  <!-- #access-lastmod -->


              <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/web/">web</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ctf/">ctf</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/php/">php</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/algorithm/">algorithm</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/python/">python</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/arcgis/">arcgis</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/blogs/">blogs</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/c-c/">c/c++</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/coding/">coding</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/computer-science/">computer science</a>
      
    </div>
  </section>


            </div>

            
              
              






  <div class="toc-border-cover z-3"></div>
  <section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4">
    <h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2>
    <nav id="toc"></nav>
  </section>


            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->















  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  











  <aside id="related-posts" aria-labelledby="related-label">
    <h3 class="mb-4" id="related-label">Further Reading</h3>
    <nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4">
      
        <article class="col">
          <a href="/posts/ea-a/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1745841000"
  data-df="ll"
  
>
  Apr 28, 2025
</time>

              <h4 class="pt-0 my-2">全过程电路分析基础实验</h4>
              <div class="text-muted">
                <p>BIT电路分析基础课程实验</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/his-gis-sys/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1742988000"
  data-df="ll"
  
>
  Mar 26, 2025
</time>

              <h4 class="pt-0 my-2">史纲课展示——第一次鸦片战争GIS</h4>
              <div class="text-muted">
                <p>近代史刚要的课程大作业，一段奇妙的回忆</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/arcgis/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1741689900"
  data-df="ll"
  
>
  Mar 11, 2025
</time>

              <h4 class="pt-0 my-2">记一次ArcGIS学习与操作</h4>
              <div class="text-muted">
                <p>近代史纲要的作业</p>
              </div>
            </div>
          </a>
        </article>
      
    </nav>
  </aside>
  <!-- #related-posts -->


            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <a
      href="/posts/ctfwp/"
      class="btn btn-outline-primary"
      aria-label="Older"
    >
      <p>在BITs2sys刷题的一些wp</p>
    </a>
  

  
    <a
      href="/posts/c-in-bit/"
      class="btn btn-outline-primary"
      aria-label="Newer"
    >
      <p>一些神奇的C语言题目</p>
    </a>
  
</nav>

            

            <!-- The Footer -->

<footer
  aria-label="Site Info"
  class="
    d-flex flex-column justify-content-center text-muted
    flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3
  "
>
  <p>©
    <time>2025</time>

    
      <a href="https://github.com/lamaper">lamaper</a>.
    

    
      <span
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author."
      >Some rights reserved.</span>
    
  </p>

  <p>Using the <a
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="v7.4.1"
        href="https://github.com/cotes2020/jekyll-theme-chirpy"
        target="_blank"
        rel="noopener"
      >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.
  </p>
</footer>

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center d-none">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/web/">web</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ctf/">ctf</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/php/">php</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/algorithm/">algorithm</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/python/">python</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/arcgis/">arcgis</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/blogs/">blogs</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/c-c/">c/c++</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/coding/">coding</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/computer-science/">computer science</a>
      
    </div>
  </section>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">A new version of content is available.</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      Update
    </button>
  </div>
</aside>

    

    <!-- Embedded scripts -->

    
      
      <!-- The comments switcher -->


    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  
  document.addEventListener('DOMContentLoaded', () => {
    SimpleJekyllSearch({
      searchInput: document.getElementById('search-input'),
      resultsContainer: document.getElementById('search-results'),
      json: '/assets/js/data/search.json',
      searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{content}</p>  </article>',
      noResultsText: '<p class="mt-5">Oops! No results found.</p>',
      templateMiddleware: function(prop, value, template) {
        if (prop === 'categories') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
          }
        }

        if (prop === 'tags') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
          }
        }
      }
    });
  });
</script>

  </body>
</html>

