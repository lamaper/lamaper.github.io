<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="Intro\r清明节献祭了假期，来打建模大赛。第一次打建模，实际上处于一个什么都不会的状态，全靠大语言模型来协助与学习。但是仔细思考过后，我认为自己不应该做一个知识的搬运工，既然搬运都搬运了，那就在这过程中把能学的都学会，不然最后的收获就是零蛋。\n抱着这个想法，开始复盘一下这次数学建模的历程，看看能从中学到什么。\n2025年北京理工大学数学建模竞赛A题 租房价格\nAirbnb 作为全球领先的短租平台，其房源价格受多种因素影响，包括地理位置、房源属性、市场供需关系及房东经营策略等。合理的定价不仅影响房东的收益，也直接关系到房源的入住率和市场竞争力。请基于2024年纽约市 Airbnb 房源数据，针对平台上房源经营与定价问题展开深入研究。\n参赛者需基于附件1所给数据，建立数学模型回答如下问题：\n对原始数据进行预处理，包括缺失、异常与重复数据的检测与处理，并说明判断缺失、异常的理由以及处理的方法。利用描述性统计分析，定量地呈现数据各指标的分布特性和基本统计规律。针对房源在不同维度上的表现，分析各个细分市场的特征、分布规律及其潜在的经营价值，为制定针对性策略提供理论依据。分析地理位置及其他相关变量对房价、入住率的影响，给出空间自相关性和地理位置的差异对房价、入住率的影响，揭示各因素之间的内在联系。考虑不同细分市场和区域之间的差异性，给出兼顾收益与入住率的最优定价策略。策略实施过程中可能面临哪些风险？请给出相应的改进方向。\n附件1中各字段的意义解释：\nid：每个房源的唯一标识符，用于区分不同的房源。\nname：房源的名称或标题，通常由房东设置，用以描述房源特点或吸引住客。\nhost_id：房东的唯一标识符，每个房东对应一个 host_id，用来关联同一房东的多个房源。\nhost_name：房东的名称，有时是昵称或真实姓名，便于识别房东。\nneighbourhood_group：较大区域的分组，在纽约市中通常指曼哈顿、布鲁克林、皇后区等大区。\nneighbourhood：具体的街区或小区域，标识房源所在的更细致位置。\nlatitude：房源位置的纬度坐标，用于在地图上定位。\nlongitude：房源位置的经度坐标，同样用于地理定位。\nroom_type：房间类型，常见的有整套房源、私人房间和共享房间，反映住客能享受的空间类型。\nprice：房源每晚的租金价格，通常以美元为单位。\nminimum_nights：预订该房源所要求的最少入住夜数。\nnumber_of_reviews：房源累计获得的评价数量，反映住客的反馈记录。\nlast_review：最近一次评价的日期，表示最近一次住客反馈的时间。\nreviews_per_month：平均每月收到的评价数量，可以反映房源的预订活跃度。\ncalculated_host_listings_count：房东在平台上所发布的房源数量，展示房东的房源管理规模。\navailability_365：表示房源在一年中可供预订的天数，用于衡量房源的空置率或使用率。\nnumber_of_reviews_ltm：最近12个月内获得的评价数量，反映近期的预订情况和住客反馈。\nlicense：房源的营业执照或许可号码（若有提供），用于证明房源符合当地的出租规定和法规要求。\n首先对赛题进行拆解，个人认为这个赛题十分人性化了，已经把该给到的都给了。最终经过分析，我们队伍把问题拆分成了如下几点：\n1-1 对原始数据进行预处理：包括缺失、异常与重复数据的检测与处理\n1-2 说明判断缺失、异常的理由以及处理方法\n1-3 利用描述性统计分析，定量地呈现数据各指标的分布特性和基本统计规律\n2-1 针对房源在不同维度上的表现\n2-2 分析各个细分市场的特征、分布规律及其潜在经营价值\n2-3 为制定针对性策略提供理论依据\n3-1 分析地理位置及其他相关变量对房价、入住率的影响\n3-2 给出空间自相关性和地理位置的差异对房价、入住率的影响\n3-3 揭示各因素(3-1 &amp; 3-2)之间的内在联系\n4-1 考虑(不同细分市场的差异性)和(不同区域之间的差异性)\n给出兼顾收益与入住率的最优定价策略\n4-2 思考策略实施过程中可能面临的风险,并给出相应的改进方向\n之后就开始愉快地工作。首先是数据处理，为了让论文更加的高大上，我们决定来点骚的，看上去厉害的方法。在大语言模型的建议下，我们采用了多重插补法（MICE）对数据进行处理。\nMultiple Imputation by Chained Equations\rMICE（Multiple Imputation by Chained Equations）是一种基于贝叶斯思想的多重插补技术，用于处理缺失数据。它的基本原理是通过多次迭代，根据已有数据的信息来估计缺失值，并且不断更新估计模型。具体地，MICE将变量分为两类：需要插值的目标变量和其他辅助变量。然后，对于每个目标变量，MICE利用其他辅助变量的信息来进行插值，并不断迭代，直到收敛为止。\n从mice到missForest：常用数据插值方法优缺点 - 知乎的3.1部分介绍了这一技术的详细原理。MICE具有灵活性，能够根据数据集的特点进行模型选择和参数调整，同时对于缺失模式的敏感性较低。但在处理非线性关系和大规模数据集时表现一般。这里主要对如何进行MICE进行讨论和研究，以确保这个方法有可复现性。\n">
<title>2025数学建模第一次校赛</title>

<link rel='canonical' href='https://lamaper.github.io/p/2025%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1%E7%AC%AC%E4%B8%80%E6%AC%A1%E6%A0%A1%E8%B5%9B/'>

<link rel="stylesheet" href="/scss/style.min.64bf2e87443aa336f3a74572bf9f691351951bd9b72457795c5ab65e9b853c27.css"><meta property='og:title' content="2025数学建模第一次校赛">
<meta property='og:description' content="Intro\r清明节献祭了假期，来打建模大赛。第一次打建模，实际上处于一个什么都不会的状态，全靠大语言模型来协助与学习。但是仔细思考过后，我认为自己不应该做一个知识的搬运工，既然搬运都搬运了，那就在这过程中把能学的都学会，不然最后的收获就是零蛋。\n抱着这个想法，开始复盘一下这次数学建模的历程，看看能从中学到什么。\n2025年北京理工大学数学建模竞赛A题 租房价格\nAirbnb 作为全球领先的短租平台，其房源价格受多种因素影响，包括地理位置、房源属性、市场供需关系及房东经营策略等。合理的定价不仅影响房东的收益，也直接关系到房源的入住率和市场竞争力。请基于2024年纽约市 Airbnb 房源数据，针对平台上房源经营与定价问题展开深入研究。\n参赛者需基于附件1所给数据，建立数学模型回答如下问题：\n对原始数据进行预处理，包括缺失、异常与重复数据的检测与处理，并说明判断缺失、异常的理由以及处理的方法。利用描述性统计分析，定量地呈现数据各指标的分布特性和基本统计规律。针对房源在不同维度上的表现，分析各个细分市场的特征、分布规律及其潜在的经营价值，为制定针对性策略提供理论依据。分析地理位置及其他相关变量对房价、入住率的影响，给出空间自相关性和地理位置的差异对房价、入住率的影响，揭示各因素之间的内在联系。考虑不同细分市场和区域之间的差异性，给出兼顾收益与入住率的最优定价策略。策略实施过程中可能面临哪些风险？请给出相应的改进方向。\n附件1中各字段的意义解释：\nid：每个房源的唯一标识符，用于区分不同的房源。\nname：房源的名称或标题，通常由房东设置，用以描述房源特点或吸引住客。\nhost_id：房东的唯一标识符，每个房东对应一个 host_id，用来关联同一房东的多个房源。\nhost_name：房东的名称，有时是昵称或真实姓名，便于识别房东。\nneighbourhood_group：较大区域的分组，在纽约市中通常指曼哈顿、布鲁克林、皇后区等大区。\nneighbourhood：具体的街区或小区域，标识房源所在的更细致位置。\nlatitude：房源位置的纬度坐标，用于在地图上定位。\nlongitude：房源位置的经度坐标，同样用于地理定位。\nroom_type：房间类型，常见的有整套房源、私人房间和共享房间，反映住客能享受的空间类型。\nprice：房源每晚的租金价格，通常以美元为单位。\nminimum_nights：预订该房源所要求的最少入住夜数。\nnumber_of_reviews：房源累计获得的评价数量，反映住客的反馈记录。\nlast_review：最近一次评价的日期，表示最近一次住客反馈的时间。\nreviews_per_month：平均每月收到的评价数量，可以反映房源的预订活跃度。\ncalculated_host_listings_count：房东在平台上所发布的房源数量，展示房东的房源管理规模。\navailability_365：表示房源在一年中可供预订的天数，用于衡量房源的空置率或使用率。\nnumber_of_reviews_ltm：最近12个月内获得的评价数量，反映近期的预订情况和住客反馈。\nlicense：房源的营业执照或许可号码（若有提供），用于证明房源符合当地的出租规定和法规要求。\n首先对赛题进行拆解，个人认为这个赛题十分人性化了，已经把该给到的都给了。最终经过分析，我们队伍把问题拆分成了如下几点：\n1-1 对原始数据进行预处理：包括缺失、异常与重复数据的检测与处理\n1-2 说明判断缺失、异常的理由以及处理方法\n1-3 利用描述性统计分析，定量地呈现数据各指标的分布特性和基本统计规律\n2-1 针对房源在不同维度上的表现\n2-2 分析各个细分市场的特征、分布规律及其潜在经营价值\n2-3 为制定针对性策略提供理论依据\n3-1 分析地理位置及其他相关变量对房价、入住率的影响\n3-2 给出空间自相关性和地理位置的差异对房价、入住率的影响\n3-3 揭示各因素(3-1 &amp; 3-2)之间的内在联系\n4-1 考虑(不同细分市场的差异性)和(不同区域之间的差异性)\n给出兼顾收益与入住率的最优定价策略\n4-2 思考策略实施过程中可能面临的风险,并给出相应的改进方向\n之后就开始愉快地工作。首先是数据处理，为了让论文更加的高大上，我们决定来点骚的，看上去厉害的方法。在大语言模型的建议下，我们采用了多重插补法（MICE）对数据进行处理。\nMultiple Imputation by Chained Equations\rMICE（Multiple Imputation by Chained Equations）是一种基于贝叶斯思想的多重插补技术，用于处理缺失数据。它的基本原理是通过多次迭代，根据已有数据的信息来估计缺失值，并且不断更新估计模型。具体地，MICE将变量分为两类：需要插值的目标变量和其他辅助变量。然后，对于每个目标变量，MICE利用其他辅助变量的信息来进行插值，并不断迭代，直到收敛为止。\n从mice到missForest：常用数据插值方法优缺点 - 知乎的3.1部分介绍了这一技术的详细原理。MICE具有灵活性，能够根据数据集的特点进行模型选择和参数调整，同时对于缺失模式的敏感性较低。但在处理非线性关系和大规模数据集时表现一般。这里主要对如何进行MICE进行讨论和研究，以确保这个方法有可复现性。\n">
<meta property='og:url' content='https://lamaper.github.io/p/2025%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1%E7%AC%AC%E4%B8%80%E6%AC%A1%E6%A0%A1%E8%B5%9B/'>
<meta property='og:site_name' content='lamaper的博客'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='mm' /><meta property='article:tag' content='python' /><meta property='article:tag' content='math' /><meta property='article:published_time' content='2025-04-06T23:50:00&#43;08:00'/><meta property='article:modified_time' content='2025-04-06T23:50:00&#43;08:00'/>
<meta name="twitter:title" content="2025数学建模第一次校赛">
<meta name="twitter:description" content="Intro\r清明节献祭了假期，来打建模大赛。第一次打建模，实际上处于一个什么都不会的状态，全靠大语言模型来协助与学习。但是仔细思考过后，我认为自己不应该做一个知识的搬运工，既然搬运都搬运了，那就在这过程中把能学的都学会，不然最后的收获就是零蛋。\n抱着这个想法，开始复盘一下这次数学建模的历程，看看能从中学到什么。\n2025年北京理工大学数学建模竞赛A题 租房价格\nAirbnb 作为全球领先的短租平台，其房源价格受多种因素影响，包括地理位置、房源属性、市场供需关系及房东经营策略等。合理的定价不仅影响房东的收益，也直接关系到房源的入住率和市场竞争力。请基于2024年纽约市 Airbnb 房源数据，针对平台上房源经营与定价问题展开深入研究。\n参赛者需基于附件1所给数据，建立数学模型回答如下问题：\n对原始数据进行预处理，包括缺失、异常与重复数据的检测与处理，并说明判断缺失、异常的理由以及处理的方法。利用描述性统计分析，定量地呈现数据各指标的分布特性和基本统计规律。针对房源在不同维度上的表现，分析各个细分市场的特征、分布规律及其潜在的经营价值，为制定针对性策略提供理论依据。分析地理位置及其他相关变量对房价、入住率的影响，给出空间自相关性和地理位置的差异对房价、入住率的影响，揭示各因素之间的内在联系。考虑不同细分市场和区域之间的差异性，给出兼顾收益与入住率的最优定价策略。策略实施过程中可能面临哪些风险？请给出相应的改进方向。\n附件1中各字段的意义解释：\nid：每个房源的唯一标识符，用于区分不同的房源。\nname：房源的名称或标题，通常由房东设置，用以描述房源特点或吸引住客。\nhost_id：房东的唯一标识符，每个房东对应一个 host_id，用来关联同一房东的多个房源。\nhost_name：房东的名称，有时是昵称或真实姓名，便于识别房东。\nneighbourhood_group：较大区域的分组，在纽约市中通常指曼哈顿、布鲁克林、皇后区等大区。\nneighbourhood：具体的街区或小区域，标识房源所在的更细致位置。\nlatitude：房源位置的纬度坐标，用于在地图上定位。\nlongitude：房源位置的经度坐标，同样用于地理定位。\nroom_type：房间类型，常见的有整套房源、私人房间和共享房间，反映住客能享受的空间类型。\nprice：房源每晚的租金价格，通常以美元为单位。\nminimum_nights：预订该房源所要求的最少入住夜数。\nnumber_of_reviews：房源累计获得的评价数量，反映住客的反馈记录。\nlast_review：最近一次评价的日期，表示最近一次住客反馈的时间。\nreviews_per_month：平均每月收到的评价数量，可以反映房源的预订活跃度。\ncalculated_host_listings_count：房东在平台上所发布的房源数量，展示房东的房源管理规模。\navailability_365：表示房源在一年中可供预订的天数，用于衡量房源的空置率或使用率。\nnumber_of_reviews_ltm：最近12个月内获得的评价数量，反映近期的预订情况和住客反馈。\nlicense：房源的营业执照或许可号码（若有提供），用于证明房源符合当地的出租规定和法规要求。\n首先对赛题进行拆解，个人认为这个赛题十分人性化了，已经把该给到的都给了。最终经过分析，我们队伍把问题拆分成了如下几点：\n1-1 对原始数据进行预处理：包括缺失、异常与重复数据的检测与处理\n1-2 说明判断缺失、异常的理由以及处理方法\n1-3 利用描述性统计分析，定量地呈现数据各指标的分布特性和基本统计规律\n2-1 针对房源在不同维度上的表现\n2-2 分析各个细分市场的特征、分布规律及其潜在经营价值\n2-3 为制定针对性策略提供理论依据\n3-1 分析地理位置及其他相关变量对房价、入住率的影响\n3-2 给出空间自相关性和地理位置的差异对房价、入住率的影响\n3-3 揭示各因素(3-1 &amp; 3-2)之间的内在联系\n4-1 考虑(不同细分市场的差异性)和(不同区域之间的差异性)\n给出兼顾收益与入住率的最优定价策略\n4-2 思考策略实施过程中可能面临的风险,并给出相应的改进方向\n之后就开始愉快地工作。首先是数据处理，为了让论文更加的高大上，我们决定来点骚的，看上去厉害的方法。在大语言模型的建议下，我们采用了多重插补法（MICE）对数据进行处理。\nMultiple Imputation by Chained Equations\rMICE（Multiple Imputation by Chained Equations）是一种基于贝叶斯思想的多重插补技术，用于处理缺失数据。它的基本原理是通过多次迭代，根据已有数据的信息来估计缺失值，并且不断更新估计模型。具体地，MICE将变量分为两类：需要插值的目标变量和其他辅助变量。然后，对于每个目标变量，MICE利用其他辅助变量的信息来进行插值，并不断迭代，直到收敛为止。\n从mice到missForest：常用数据插值方法优缺点 - 知乎的3.1部分介绍了这一技术的详细原理。MICE具有灵活性，能够根据数据集的特点进行模型选择和参数调整，同时对于缺失模式的敏感性较低。但在处理非线性关系和大规模数据集时表现一般。这里主要对如何进行MICE进行讨论和研究，以确保这个方法有可复现性。\n">
    <link rel="shortcut icon" href="https://avatars.githubusercontent.com/u/108182318?v=4" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    <img src="https://avatars.githubusercontent.com/u/108182318?v=4" width="300" height="300" class="site-logo" loading="lazy" alt="Avatar">
                
                </a>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">lamaper的博客</a></h1>
            <h2 class="site-description">你好，我是lamaper，BIT学生，喜欢与计算机相关的所有东西！</h2>
        </div>
    </header><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>首页</span>
            </a>
        </li>
        
        
        <li >
            <a href='/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>关于</span>
            </a>
        </li>
        
        
        <li >
            <a href='https://github.com/lamaper' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                
                <span>Github</span>
            </a>
        </li>
        
        
        <li >
            <a href='https://www.cnblogs.com/lamaper' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>博客园</span>
            </a>
        </li>
        
        
        <li >
            <a href='https://space.bilibili.com/450695599' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Bilibili</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">
                    
                        <li id="i18n-switch">  
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                            <select name="language" title="language" onchange="window.location.href = this.selectedOptions[0].value">
                                
                                    <option value="https://lamaper.github.io/" selected>简体中文</option>
                                
                                    <option value="https://lamaper.github.io/en/" >English</option>
                                
                            </select>
                        </li>
                    
                

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>暗色模式</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">目录</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li>
      <ol>
        <li><a href="#intro">Intro</a></li>
        <li><a href="#multiple-imputation-by-chained-equations">Multiple Imputation by Chained Equations</a></li>
        <li><a href="#matplotlib">Matplotlib</a></li>
        <li><a href="#解决方案">解决方案</a></li>
        <li><a href="#随机森林">随机森林</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
            
                <form action="/search/" class="search-form widget" >
        <p>
            <label>搜索</label>
            <input name="keyword" required placeholder="输入关键词..." />
        
            <button title="搜索">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



            </button>
        </p>
    </form>
            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/mathematics-modeling/" >
                Mathematics Modeling
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/2025%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1%E7%AC%AC%E4%B8%80%E6%AC%A1%E6%A0%A1%E8%B5%9B/">2025数学建模第一次校赛</a>
        </h2>
        
        
        <p class="article-preview">
            摘要：
            Intro清明节献祭了假期，来打建模大赛。第一次打建模，实际上处于一个什么都不会的状态，全靠大语言模型来协助与学习。但是仔细思考过后，我认为自己不应该做一个知识的搬运工，既然搬运都搬运了，那就在这过程中把能学的都学会，不然最后的收获就是零蛋。
抱着这个想法，开始复盘一下这次数学建模的历程，看看能从中学到什么。
2025年北京理工大学数学建模竞赛A题 租房价格
Airbnb 作为全球领先的短租平 …
        </p>

    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Apr 06, 2025</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    阅读时长: 6 分钟
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h3 id="intro">Intro
</h3><p>清明节献祭了假期，来打建模大赛。第一次打建模，实际上处于一个什么都不会的状态，全靠大语言模型来协助与学习。但是仔细思考过后，我认为自己不应该做一个知识的搬运工，既然搬运都搬运了，那就在这过程中把能学的都学会，不然最后的收获就是零蛋。</p>
<p>抱着这个想法，开始复盘一下这次数学建模的历程，看看能从中学到什么。</p>
<blockquote>
<p><strong>2025年北京理工大学数学建模竞赛A题 租房价格</strong></p>
<p>Airbnb 作为全球领先的短租平台，其房源价格受多种因素影响，包括地理位置、房源属性、市场供需关系及房东经营策略等。合理的定价不仅影响房东的收益，也直接关系到房源的入住率和市场竞争力。请基于2024年纽约市 Airbnb 房源数据，针对平台上房源经营与定价问题展开深入研究。</p>
<p>参赛者需基于附件1所给数据，建立数学模型回答如下问题：</p>
<p>对原始数据进行预处理，包括缺失、异常与重复数据的检测与处理，并说明判断缺失、异常的理由以及处理的方法。利用描述性统计分析，定量地呈现数据各指标的分布特性和基本统计规律。针对房源在不同维度上的表现，分析各个细分市场的特征、分布规律及其潜在的经营价值，为制定针对性策略提供理论依据。分析地理位置及其他相关变量对房价、入住率的影响，给出空间自相关性和地理位置的差异对房价、入住率的影响，揭示各因素之间的内在联系。考虑不同细分市场和区域之间的差异性，给出兼顾收益与入住率的最优定价策略。策略实施过程中可能面临哪些风险？请给出相应的改进方向。</p>
<p>附件1中各字段的意义解释：</p>
<p><strong>id</strong>：每个房源的唯一标识符，用于区分不同的房源。</p>
<p><strong>name</strong>：房源的名称或标题，通常由房东设置，用以描述房源特点或吸引住客。</p>
<p><strong>host_id</strong>：房东的唯一标识符，每个房东对应一个 host_id，用来关联同一房东的多个房源。</p>
<p><strong>host_name</strong>：房东的名称，有时是昵称或真实姓名，便于识别房东。</p>
<p><strong>neighbourhood_group</strong>：较大区域的分组，在纽约市中通常指曼哈顿、布鲁克林、皇后区等大区。</p>
<p><strong>neighbourhood</strong>：具体的街区或小区域，标识房源所在的更细致位置。</p>
<p><strong>latitude</strong>：房源位置的纬度坐标，用于在地图上定位。</p>
<p><strong>longitude</strong>：房源位置的经度坐标，同样用于地理定位。</p>
<p><strong>room_type</strong>：房间类型，常见的有整套房源、私人房间和共享房间，反映住客能享受的空间类型。</p>
<p><strong>price</strong>：房源每晚的租金价格，通常以美元为单位。</p>
<p><strong>minimum_nights</strong>：预订该房源所要求的最少入住夜数。</p>
<p><strong>number_of_reviews</strong>：房源累计获得的评价数量，反映住客的反馈记录。</p>
<p><strong>last_review</strong>：最近一次评价的日期，表示最近一次住客反馈的时间。</p>
<p><strong>reviews_per_month</strong>：平均每月收到的评价数量，可以反映房源的预订活跃度。</p>
<p><strong>calculated_host_listings_count</strong>：房东在平台上所发布的房源数量，展示房东的房源管理规模。</p>
<p><strong>availability_365</strong>：表示房源在一年中可供预订的天数，用于衡量房源的空置率或使用率。</p>
<p><strong>number_of_reviews_ltm</strong>：最近12个月内获得的评价数量，反映近期的预订情况和住客反馈。</p>
<p><strong>license</strong>：房源的营业执照或许可号码（若有提供），用于证明房源符合当地的出租规定和法规要求。</p>
</blockquote>
<p>首先对赛题进行拆解，个人认为这个赛题十分人性化了，已经把该给到的都给了。最终经过分析，我们队伍把问题拆分成了如下几点：</p>
<blockquote>
<p>1-1 对原始数据进行<strong>预处理</strong>：包括缺失、异常与重复数据的检测与处理</p>
<p>1-2 说明判断缺失、异常的理由以及处理方法</p>
<p>1-3 利用<strong>描述性统计</strong>分析，定量地呈现数据各指标的分布特性和基本统计规律</p>
<p>2-1 针对房源在<strong>不同维度</strong>上的表现</p>
<p>2-2 分析各个<strong>细分市场</strong>的特征、分布规律及其潜在经营价值</p>
<p>2-3 为制定针对性策略提供<strong>理论依据</strong></p>
<p>3-1 分析地理位置及其他相关变量对房价、入住率的<strong>影响</strong></p>
<p>3-2 给出空间自相关性和地理位置的差异对房价、入住率的影响</p>
<p>3-3 揭示各因素(3-1 &amp; 3-2)之间的<strong>内在联系</strong></p>
<p>4-1 考虑(不同细分市场的差异性)和(不同区域之间的差异性)</p>
<p>给出<strong>兼顾</strong>收益<strong>与</strong>入住率的最优<strong>定价策略</strong></p>
<p>4-2 思考策略实施过程中可能面临的<strong>风险</strong>,并给出相应的<strong>改进方向</strong></p>
</blockquote>
<p>之后就开始<del>愉快地</del>工作。首先是数据处理，为了让论文更加的高大上，我们决定来点骚的，看上去厉害的方法。在大语言模型的建议下，我们采用了多重插补法（MICE）对数据进行处理。</p>
<h3 id="multiple-imputation-by-chained-equations">Multiple Imputation by Chained Equations
</h3><blockquote>
<p>MICE（Multiple Imputation by Chained Equations）是一种基于贝叶斯思想的多重插补技术，用于处理缺失数据。它的基本原理是通过多次迭代，根据已有数据的信息来估计缺失值，并且不断更新估计模型。具体地，MICE将变量分为两类：需要插值的目标变量和其他辅助变量。然后，对于每个目标变量，MICE利用其他辅助变量的信息来进行插值，并不断迭代，直到收敛为止。</p>
</blockquote>
<p><a class="link" href="https://zhuanlan.zhihu.com/p/673954517"  target="_blank" rel="noopener"
    >从mice到missForest：常用数据插值方法优缺点 - 知乎</a>的3.1部分介绍了这一技术的详细原理。MICE具有灵活性，能够根据数据集的特点进行模型选择和参数调整，同时对于缺失模式的敏感性较低。但在处理非线性关系和大规模数据集时表现一般。这里主要对如何进行MICE进行讨论和研究，以确保这个方法有可复现性。</p>
<p>首先需要导入两个基本的库<code>pandas</code>和<code>numpy</code>，然后使用<code>statsmodels.imputation.mice</code>的mice模块来进行真正的插补操作。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">statsmodels.imputation.mice</span> <span class="kn">import</span> <span class="n">MICEData</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OrdinalEncoder</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>由于该算法通常需要数值型输入，其内部模型（如线性回归、决策树等）依赖数值计算，所以还要对非数值内容进行编码，使其变为数值，这里用到了<code>sklearn.preprocessing</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 读取原始数据</span>
</span></span><span class="line"><span class="cl"><span class="n">raw_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data_FIX.csv&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">2024</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ===== 数据预处理阶段 =====</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 1. 保留所有原始字段</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="n">raw_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 2. 处理时间特征（不删除原列）</span>
</span></span><span class="line"><span class="cl"><span class="n">max_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;last_review&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span><span class="p">[</span><span class="s1">&#39;last_review_days&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_date</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;last_review&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">days</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span><span class="p">[</span><span class="s1">&#39;license&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;license&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;UNLICENSED&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 3. 编码分类变量（创建副本列进行编码）</span>
</span></span><span class="line"><span class="cl"><span class="n">geo_encoder</span> <span class="o">=</span> <span class="n">OrdinalEncoder</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">room_type_encoder</span> <span class="o">=</span> <span class="n">OrdinalEncoder</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 创建编码副本列</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span><span class="p">[[</span><span class="s1">&#39;ng_encoded&#39;</span><span class="p">,</span> <span class="s1">&#39;n_encoded&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">geo_encoder</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="s1">&#39;neighbourhood_group&#39;</span><span class="p">,</span> <span class="s1">&#39;neighbourhood&#39;</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span><span class="p">[</span><span class="s1">&#39;rt_encoded&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">room_type_encoder</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="s1">&#39;room_type&#39;</span><span class="p">]])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>之后开始核心的插补过程。在官方文档中，可以找到每个参数的意义<a class="link" href="https://www.statsmodels.org/stable/generated/statsmodels.imputation.mice.MICE.html"  target="_blank" rel="noopener"
    >statsmodels.imputation.mice.MICE - statsmodels 0.14.4</a>，文档规定了MICE的代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">statsmodels</span><span class="o">.</span><span class="n">imputation</span><span class="o">.</span><span class="n">mice</span><span class="o">.</span><span class="n">MICEData</span><span class="p">(</span><span class="n">data</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">perturbation_method</span><span class="o">=</span><span class="s1">&#39;gaussian&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">k_pmm</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">history_callback</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>参数</th>
          <th>类型</th>
          <th>含义</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>data</td>
          <td><code>Pandas</code> ,<code>data</code> ,<code>frame</code></td>
          <td>The data set, which is copied internally.这里是值传递</td>
      </tr>
      <tr>
          <td>perturbation_method</td>
          <td><code>str</code></td>
          <td>The default perturbation method.即默认的扰动模型，这里默认为高斯扰动。另外还可以选择boot模型，</td>
      </tr>
      <tr>
          <td>k_pmm</td>
          <td><code>int</code></td>
          <td>The number of nearest neighbors to use during predictive mean matching. PMM是一种基于模型的数据插补方法，它通过建立预测模型来预测缺失值，并根据预测结果从已有的观察值中选择一个最接近的均值进行匹配。 K_pmm=20表示从预测均值最近的 20 个观测值中随机选择一个作为插补值。</td>
      </tr>
      <tr>
          <td>history_callback</td>
          <td>function</td>
          <td>规定了是否需要返回操作记录。</td>
      </tr>
  </tbody>
</table></div>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># ===== 多重插补实现 =====</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 选择需要插补的数值列</span>
</span></span><span class="line"><span class="cl"><span class="n">impute_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="s1">&#39;minimum_nights&#39;</span><span class="p">,</span> <span class="s1">&#39;number_of_reviews&#39;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                 <span class="s1">&#39;reviews_per_month&#39;</span><span class="p">,</span> <span class="s1">&#39;calculated_host_listings_count&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                 <span class="s1">&#39;availability_365&#39;</span><span class="p">,</span> <span class="s1">&#39;number_of_reviews_ltm&#39;</span><span class="p">,</span> <span class="s1">&#39;last_review_days&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                 <span class="s1">&#39;ng_encoded&#39;</span><span class="p">,</span> <span class="s1">&#39;n_encoded&#39;</span><span class="p">,</span> <span class="s1">&#39;rt_encoded&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 执行MICE插补</span>
</span></span><span class="line"><span class="cl"><span class="n">imp</span> <span class="o">=</span> <span class="n">MICEData</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">impute_columns</span><span class="p">],</span> <span class="n">perturbation_method</span><span class="o">=</span><span class="s1">&#39;gaussian&#39;</span><span class="p">,</span> <span class="n">k_pmm</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">imp</span><span class="o">.</span><span class="n">update_all</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 合并插补结果</span>
</span></span><span class="line"><span class="cl"><span class="n">imputed_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">imputed_data</span><span class="p">[</span><span class="n">impute_columns</span><span class="p">]</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">data</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后是后处理阶段。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># ===== 后处理阶段 =====</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 1. 恢复分类变量</span>
</span></span><span class="line"><span class="cl"><span class="n">imputed_data</span><span class="p">[[</span><span class="s1">&#39;neighbourhood_group&#39;</span><span class="p">,</span> <span class="s1">&#39;neighbourhood&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">geo_encoder</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">imputed_data</span><span class="p">[[</span><span class="s1">&#39;ng_encoded&#39;</span><span class="p">,</span> <span class="s1">&#39;n_encoded&#39;</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl"><span class="n">imputed_data</span><span class="p">[</span><span class="s1">&#39;room_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">room_type_encoder</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">imputed_data</span><span class="p">[[</span><span class="s1">&#39;rt_encoded&#39;</span><span class="p">]])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 2. 恢复last_review日期</span>
</span></span><span class="line"><span class="cl"><span class="n">imputed_data</span><span class="p">[</span><span class="s1">&#39;last_review&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">imputed_data</span><span class="p">[</span><span class="s1">&#39;last_review&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="n">max_date</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">imputed_data</span><span class="p">[</span><span class="s1">&#39;last_review_days&#39;</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">imputed_data</span><span class="p">[</span><span class="s1">&#39;last_review&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 3. 清理中间列</span>
</span></span><span class="line"><span class="cl"><span class="n">imputed_data</span> <span class="o">=</span> <span class="n">imputed_data</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;ng_encoded&#39;</span><span class="p">,</span> <span class="s1">&#39;n_encoded&#39;</span><span class="p">,</span> <span class="s1">&#39;rt_encoded&#39;</span><span class="p">,</span> <span class="s1">&#39;last_review_days&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#价格异常值处理</span>
</span></span><span class="line"><span class="cl"><span class="n">imputed_data</span> <span class="o">=</span> <span class="n">imputed_data</span><span class="p">[(</span><span class="n">imputed_data</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">imputed_data</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 保存结果</span>
</span></span><span class="line"><span class="cl"><span class="n">imputed_data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;imputed_data_FIX_full.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="matplotlib">Matplotlib
</h3><p>最终还有一个绘图，这里用到了<code>matplotlib</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 绘制价格分布对比图</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&#34;font.sans-serif&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;SimHei&#34;</span><span class="p">]</span>  <span class="c1"># 设置字体</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&#34;axes.unicode_minus&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># 正常显示负号</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 原始数据分布</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">raw_data</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2500</span><span class="p">))</span>  <span class="c1"># 直接限定数据范围</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;原始价格分布 (n=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">raw_data</span><span class="p">)</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Price (USD)&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2500</span><span class="p">)</span>  <span class="c1"># 双重保险设置显示范围[5,7](@ref)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 插补后数据分布</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">imputed_data</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2500</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;插补后价格分布 (n=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">imputed_data</span><span class="p">)</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Price (USD)&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2500</span><span class="p">)</span>  <span class="c1"># 同步设置显示范围</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>  <span class="c1"># 自动调整子图间距</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;output_FIX.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>这里要特别非常强调一个问题，matplotlib默认的中文绘图需要自己的电脑带有中文字体，否则会出现很多麻烦的问题。</p>
<p>我的环境是Windows11 23H2工作站版下的WSL2 Ubuntu24.02 LTSC，虽然系统已经是中文版，但并不带有中文字体。一开始我在这个问题上折腾了很久。<a class="link" href="https://zhuanlan.zhihu.com/p/566430362"  target="_blank" rel="noopener"
    >百分百解决你的matplotlib画图中文乱码问题 - 知乎</a>，在这个文档的帮助下，得以解决问题，为了防止原文被删，这里引用一下原文：</p>
<blockquote>
<h3 id="解决方案">解决方案
</h3><ol>
<li>首先<strong>删除你的缓存</strong>。找到你的缓存</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">import matplotlib as mpl
</span></span><span class="line"><span class="cl">print(mpl.get_cachedir())
</span></span><span class="line"><span class="cl"># /Users/xiewenwen/.matplotlib
</span></span></code></pre></td></tr></table>
</div>
</div><p>我的缓存文件夹是：/Users/xiewenwen/.matplotlib</p>
<p>删除这个缓存文件夹：rm -rf /Users/xiewenwen/.matplotlib/*</p>
<p>有评论说删除缓存就可以了，你也可以试一试。</p>
<p>2.下载SeiHei.ttf字体放入~<strong>/.fonts</strong>目录下。</p>
<p>或者复制这个链接下载</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">http://139.199.170.86/downloads/SimHei.ttf
</span></span></code></pre></td></tr></table>
</div>
</div><p>安装SimHei的命令：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">（1）cd ~/.fonts 。如果没有就mkdir ~/.fonts
</span></span><span class="line"><span class="cl">（2）wget http://139.199.170.86/downloads/SimHei.ttf
</span></span><span class="line"><span class="cl">（3）安装fc-cache的命令
</span></span><span class="line"><span class="cl">   # 如果你是centos 
</span></span><span class="line"><span class="cl">   sudo yum install fontconfig -y
</span></span><span class="line"><span class="cl">   # 如果你是ubuntu
</span></span><span class="line"><span class="cl">   sudo apt-get install fontconfig -y
</span></span><span class="line"><span class="cl">   # 如果你是mac
</span></span><span class="line"><span class="cl">   brew install fontconfig
</span></span><span class="line"><span class="cl">（4）再执行 fc-cache -fv    刷新字体缓存
</span></span></code></pre></td></tr></table>
</div>
</div></blockquote>
<h3 id="随机森林">随机森林
</h3><p>在最后一个问题中，我们使用了随机森林的方法来寻找最优解，随机森林核心参数如下：</p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th style="text-align: left">参数</th>
          <th style="text-align: left">意义</th>
          <th style="text-align: left">调参建议</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left"><code>n_estimators</code></td>
          <td style="text-align: left">决策树的数量</td>
          <td style="text-align: left">增加树的数量提升稳定性，但计算成本增加（通常100-500）。</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>max_depth</code></td>
          <td style="text-align: left">单棵树的最大深度</td>
          <td style="text-align: left">过大导致过拟合，过小导致欠拟合（常用5-20）。</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>min_samples_leaf</code></td>
          <td style="text-align: left">叶节点所需最小样本数</td>
          <td style="text-align: left">增大可防止过拟合（常用1-10）。</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>max_features</code></td>
          <td style="text-align: left">每棵树分裂时考虑的特征数（默认<code>auto</code>）</td>
          <td style="text-align: left">减少特征数可降低方差，常用<code>sqrt(n_features)</code>。</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>n_jobs</code></td>
          <td style="text-align: left">并行计算使用的CPU核心数</td>
          <td style="text-align: left">设为-1使用全部核心加速训练。</td>
      </tr>
  </tbody>
</table></div>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># -*- coding: utf-8 -*-</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span><span class="p">,</span> <span class="n">mean_squared_error</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&#34;font.sans-serif&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;SimHei&#34;</span><span class="p">]</span>  <span class="c1"># 设置字体</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&#34;axes.unicode_minus&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># 正常显示负号</span>
</span></span><span class="line"><span class="cl"><span class="c1"># --------------------------</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 数据预处理与收益参数计算</span>
</span></span><span class="line"><span class="cl"><span class="c1"># --------------------------</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">preprocess_data</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 加载数据</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 计算入住率 (Occupancy Rate = 1 - availability_365/365)</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;occupancy_rate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;availability_365&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">365</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 定义收益参数</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 曼哈顿成本最高（参数最低），布鲁克林次之，其他区域更高</span>
</span></span><span class="line"><span class="cl">    <span class="n">revenue_param_map</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;Manhattan&#39;</span><span class="p">:</span><span class="mf">0.374669</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;Brooklyn&#39;</span><span class="p">:</span> <span class="mf">0.510500</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;Queens&#39;</span><span class="p">:</span> <span class="mf">0.470317</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;Bronx&#39;</span><span class="p">:</span> <span class="mf">0.504385</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;Staten Island&#39;</span><span class="p">:</span> <span class="mf">0.500000</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;revenue_param&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;neighbourhood_group&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">revenue_param_map</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 计算收益目标变量 (Revenue = Price * Occupancy Rate * Revenue Parameter)</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;revenue&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;occupancy_rate&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;revenue_param&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 特征选择</span>
</span></span><span class="line"><span class="cl">    <span class="n">features</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;neighbourhood_group&#39;</span><span class="p">,</span>  <span class="c1"># 大区域分组</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;latitude&#39;</span><span class="p">,</span>             <span class="c1"># 纬度</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;longitude&#39;</span><span class="p">,</span>            <span class="c1"># 经度</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;room_type&#39;</span><span class="p">,</span>            <span class="c1"># 房源类型</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;minimum_nights&#39;</span><span class="p">,</span>       <span class="c1"># 最少入住天数</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;number_of_reviews&#39;</span><span class="p">,</span>    <span class="c1"># 累计评价数</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;reviews_per_month&#39;</span><span class="p">,</span>    <span class="c1"># 每月评价数（反映活跃度）</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;calculated_host_listings_count&#39;</span><span class="p">,</span>  <span class="c1"># 房东房源总数</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;availability_365&#39;</span><span class="p">,</span>     <span class="c1"># 可预订天数（用于计算入住率）</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;number_of_reviews_ltm&#39;</span><span class="p">,</span><span class="c1"># 近12个月评价数</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;price&#39;</span>                 <span class="c1"># 原始价格（作为可调节变量）</span>
</span></span><span class="line"><span class="cl">    <span class="p">]]</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 对分类变量进行独热编码</span>
</span></span><span class="line"><span class="cl">    <span class="n">encoder</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">sparse_output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">encoded_cats</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">features</span><span class="p">[[</span><span class="s1">&#39;neighbourhood_group&#39;</span><span class="p">,</span> <span class="s1">&#39;room_type&#39;</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl">    <span class="n">encoded_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">encoded_cats</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">columns</span><span class="o">=</span><span class="n">encoder</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">([</span><span class="s1">&#39;neighbourhood_group&#39;</span><span class="p">,</span> <span class="s1">&#39;room_type&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 合并数值型特征</span>
</span></span><span class="line"><span class="cl">    <span class="n">numerical_features</span> <span class="o">=</span> <span class="n">features</span><span class="p">[[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;minimum_nights&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;number_of_reviews&#39;</span><span class="p">,</span> <span class="s1">&#39;reviews_per_month&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;calculated_host_listings_count&#39;</span><span class="p">,</span> <span class="s1">&#39;number_of_reviews_ltm&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;price&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="p">]]</span>
</span></span><span class="line"><span class="cl">    <span class="n">processed_features</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">encoded_df</span><span class="p">,</span> <span class="n">numerical_features</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">df</span><span class="p">,</span> <span class="n">processed_features</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;revenue&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># --------------------------</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 随机森林建模与评估</span>
</span></span><span class="line"><span class="cl"><span class="c1"># --------------------------</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">build_rf_model</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 划分训练集和测试集</span>
</span></span><span class="line"><span class="cl">    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">features</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 初始化随机森林模型</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">n_estimators</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 模型评估</span>
</span></span><span class="line"><span class="cl">    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;模型性能评估:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;R² Score: </span><span class="si">{</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;RMSE: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 可视化特征重要性</span>
</span></span><span class="line"><span class="cl">    <span class="n">feat_importance</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">features</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">feat_importance</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;特征重要性排名&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;特征重要性排名.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">model</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># --------------------------</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 价格优化器</span>
</span></span><span class="line"><span class="cl"><span class="c1"># --------------------------</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">optimize_pricing</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">sample_features</span><span class="p">,</span> <span class="n">original_price</span><span class="p">,</span> <span class="n">price_range</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    输入:
</span></span></span><span class="line"><span class="cl"><span class="s2">        - model: 训练好的随机森林模型
</span></span></span><span class="line"><span class="cl"><span class="s2">        - sample_features: 单个房源的特征数据（需包含除price外的所有特征）
</span></span></span><span class="line"><span class="cl"><span class="s2">        - original_price: 当前价格
</span></span></span><span class="line"><span class="cl"><span class="s2">        - price_range: 价格调整范围比例（默认±50%）
</span></span></span><span class="line"><span class="cl"><span class="s2">    输出:
</span></span></span><span class="line"><span class="cl"><span class="s2">        - optimal_price: 最大化收益的最优价格
</span></span></span><span class="line"><span class="cl"><span class="s2">        - max_revenue: 对应的预测收益
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 生成价格搜索空间（当前价格的50%~150%）</span>
</span></span><span class="line"><span class="cl">    <span class="n">price_min</span> <span class="o">=</span> <span class="n">original_price</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">price_range</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">price_max</span> <span class="o">=</span> <span class="n">original_price</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">price_range</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">prices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">price_min</span><span class="p">,</span> <span class="n">price_max</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 复制特征并调整价格</span>
</span></span><span class="line"><span class="cl">    <span class="n">test_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">sample_features</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">prices</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prices</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 预测收益</span>
</span></span><span class="line"><span class="cl">    <span class="n">revenues</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 找到最优价格</span>
</span></span><span class="line"><span class="cl">    <span class="n">optimal_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">revenues</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">prices</span><span class="p">[</span><span class="n">optimal_idx</span><span class="p">],</span> <span class="n">revenues</span><span class="p">[</span><span class="n">optimal_idx</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># --------------------------</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 主程序</span>
</span></span><span class="line"><span class="cl"><span class="c1"># --------------------------</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 数据预处理</span>
</span></span><span class="line"><span class="cl">    <span class="n">df</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">preprocess_data</span><span class="p">(</span><span class="s2">&#34;imputed_data_FIX_full.csv&#34;</span><span class="p">)</span>  <span class="c1"># 替换为实际文件路径</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 训练模型</span>
</span></span><span class="line"><span class="cl">    <span class="n">rf_model</span> <span class="o">=</span> <span class="n">build_rf_model</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 示例：优化第100号房源价格</span>
</span></span><span class="line"><span class="cl">    <span class="n">sample_idx</span> <span class="o">=</span> <span class="mi">100</span>
</span></span><span class="line"><span class="cl">    <span class="n">sample_data</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">sample_idx</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">current_price</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">sample_idx</span><span class="p">][</span><span class="s1">&#39;price&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">optimal_price</span><span class="p">,</span> <span class="n">max_revenue</span> <span class="o">=</span> <span class="n">optimize_pricing</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span><span class="o">=</span><span class="n">rf_model</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">sample_features</span><span class="o">=</span><span class="n">sample_data</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">original_price</span><span class="o">=</span><span class="n">current_price</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 打印结果</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">=== 价格优化结果 ===&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;当前价格: $</span><span class="si">{</span><span class="n">current_price</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;最优价格: $</span><span class="si">{</span><span class="n">optimal_price</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;预测收益提升: </span><span class="si">{</span><span class="p">((</span><span class="n">max_revenue</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">sample_idx</span><span class="p">][</span><span class="s1">&#39;revenue&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">sample_idx</span><span class="p">][</span><span class="s1">&#39;revenue&#39;</span><span class="p">])</span><span class="si">:</span><span class="s2">.1%</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 可视化价格-收益曲线</span>
</span></span><span class="line"><span class="cl">    <span class="n">price_range</span> <span class="o">=</span> <span class="mf">0.5</span>
</span></span><span class="line"><span class="cl">    <span class="n">prices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">current_price</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">price_range</span><span class="p">),</span> <span class="n">current_price</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">price_range</span><span class="p">),</span> <span class="mi">100</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">test_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">sample_data</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">prices</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prices</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">prices</span><span class="p">,</span> <span class="n">rf_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_data</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">optimal_price</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&#34;Price&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&#34;Predicted Revenue&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;价格与收益关系曲线&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;价格与收益关系曲线.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/mm/">Mm</a>
        
            <a href="/tags/python/">Python</a>
        
            <a href="/tags/math/">Math</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI&#43;WdtXRGWt2kTvGFasHpSy3SV"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG&#43;vnGctmUb0ZY0l8"crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"integrity="sha384-&#43;VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4&#43;/RRE05"crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
	const mainArticleElement = document.querySelector(".main-article");
        renderMathInElement(mainArticleElement, {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ],
            ignoredClasses: ["gist"]
        });})
</script>

    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">相关文章</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/p/2025%E7%BB%9F%E8%AE%A1%E5%BB%BA%E6%A8%A1/">
        
        

        <div class="article-details">
            <h2 class="article-title">2025统计建模</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1%E5%88%9D%E4%BD%93%E9%AA%8C/">
        
        
            <div class="article-image">
                
                    <img src="https://img0.baidu.com/it/u=2384468154,3411645011&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=png" loading="lazy" data-key="" data-hash="https://img0.baidu.com/it/u=2384468154,3411645011&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=png"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">数学建模初体验</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2025 lamaper
    </section>
    
    <section class="powerby">
        

        <p>博客由 <b><a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a></b> 强力驱动，主题采用由 <b><a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a></b> 设计的 <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="%s">Stack</a></b> ，并由 lamaper 个性化修改。</p>
        
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
